<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>苍穹外卖笔记 | Trenchance's Home</title><link rel="stylesheet" type="text/css" href="../../../../css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="https://unpkg.com/normalize.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/pure-min.css"><link rel="stylesheet" type="text/css" href="https://unpkg.com/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="https://unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="https://unpkg.com/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="../../../../favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="../../../../favicon.ico"><link rel="apple-touch-icon" href="../../../../apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="../../../../apple-touch-icon.png"><script type="text/javascript" src="https://unpkg.com/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="https://unpkg.com/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="https://unpkg.com/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">苍穹外卖笔记</h1><a id="logo" href="../../../../.">Trenchance's Home</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="../../../../."><i class="fa fa-home"> Home</i></a><a href="../../../../archives/"><i class="fa fa-archive"> Archive</i></a><a href="../../../../about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">苍穹外卖笔记</h1><div class="post-meta">2025-07-15</div><div class="post-content"><h1 id="苍穹外卖笔记"><a href="#苍穹外卖笔记" class="headerlink" title="苍穹外卖笔记"></a>苍穹外卖笔记</h1><p>@Trenchance 2025&#x2F;07&#x2F;15</p>
<p><em>note后端启动方法：启动sky-server的SkyApplication，访问<a target="_blank" rel="noopener" href="http://localhost/#/login">苍穹外卖</a></em></p>
<p><em>swagger接口文档：<a target="_blank" rel="noopener" href="http://localhost:8080/doc.html#/home">苍穹外卖项目接口文档</a></em></p>
<p><em>每一章后面的括号代表这一章的知识点</em></p>
<h2 id="day0-Spring补充"><a href="#day0-Spring补充" class="headerlink" title="day0 Spring补充"></a>day0 Spring补充</h2><h3 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h3><p>Spring 的 <strong>Bean</strong> 就是被 Spring 容器管理的<strong>对象</strong>。也就是说，普通的 Java 对象一旦被交给 Spring 管理，就成了 “Spring Bean”。</p>
<p>在传统开发中，你自己创建对象，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br></pre></td></tr></table></figure>

<p>但在 Spring 中，对象由框架帮你创建、管理、销毁，比如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">UserService userService;</span><br></pre></td></tr></table></figure>

<p>这就是 <strong>IoC（控制反转）</strong> 的体现。</p>
<p>只要你在类上加了如下注解之一，它就会变成 Bean，交由 Spring 容器管理：</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>@Component</code></td>
<td>最基础的通用组件注解</td>
</tr>
<tr>
<td><code>@Service</code></td>
<td>业务逻辑层组件</td>
</tr>
<tr>
<td><code>@Repository</code></td>
<td>数据访问组件</td>
</tr>
<tr>
<td><code>@Controller</code></td>
<td>控制器</td>
</tr>
<tr>
<td><code>@RestController</code></td>
<td><code>@Controller + @ResponseBody</code></td>
</tr>
</tbody></table>
<p>这些注解其实都隐含了 <code>@Component</code> 的功能。</p>
<p>举个例子，首先定义一个Bean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">register</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;注册用户&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在控制器中使用它：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">register</span><span class="params">()</span> &#123;</span><br><span class="line">        userService.register();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;注册成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，什么时候需要写@Autowired：</p>
<p>当你希望 <strong>Spring 自动将某个 Bean 注入到当前类中使用</strong>，并且注入方式不是通过 <code>@Bean</code> 方法参数或构造器参数时，你需要写 <code>@Autowired</code>。</p>
<h3 id="硬编码和软编码"><a href="#硬编码和软编码" class="headerlink" title="硬编码和软编码"></a>硬编码和软编码</h3><p>硬编码（Hard Coding）是指在程序中<strong>直接将具体的值（如字符串、数字、配置项等）写死在代码中</strong>，而不是通过配置文件、参数、数据库等外部方式来获取这些值。</p>
<table>
<thead>
<tr>
<th>场景</th>
<th>错误做法（硬编码）</th>
<th>正确做法（软编码）</th>
</tr>
</thead>
<tbody><tr>
<td>文件路径</td>
<td><code>&quot;C:/myapp/logs/file.log&quot;</code></td>
<td>使用配置文件定义</td>
</tr>
<tr>
<td>密码&#x2F;密钥</td>
<td><code>&quot;admin123&quot;</code></td>
<td>使用环境变量或配置中心</td>
</tr>
<tr>
<td>页面跳转路径</td>
<td><code>&quot;/home/index&quot;</code></td>
<td>使用常量或路由映射</td>
</tr>
<tr>
<td>魔法数字</td>
<td><code>if (status == 3)</code></td>
<td>使用枚举或常量：<code>if (status == Status.APPROVED)</code></td>
</tr>
</tbody></table>
<h3 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h3><p>反射之中包含了一个「反」字，所以想要解释反射就必须先从「正」开始解释。</p>
<p>一般情况下，我们使用某个类时必定知道它是什么类，是用来做什么的。于是我们直接对这个类进行实例化，之后使用这个类对象进行操作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Apple</span> <span class="variable">apple</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Apple</span>(); <span class="comment">//直接初始化，「正射」</span></span><br><span class="line">apple.setPrice(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>上面这样子进行类对象的初始化，我们可以理解为「正」。</p>
<p>而反射则是一开始并不知道我要初始化的类对象是什么，自然也无法使用 new 关键字来创建对象了。</p>
<p>这时候，我们使用 JDK 提供的反射 API 进行反射调用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">clz</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;com.chenshuyi.reflect.Apple&quot;</span>);</span><br><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clz.getMethod(<span class="string">&quot;setPrice&quot;</span>, <span class="type">int</span>.class);</span><br><span class="line"><span class="type">Constructor</span> <span class="variable">constructor</span> <span class="operator">=</span> clz.getConstructor();</span><br><span class="line"><span class="type">Object</span> <span class="variable">object</span> <span class="operator">=</span> constructor.newInstance();</span><br><span class="line">method.invoke(object, <span class="number">4</span>);</span><br></pre></td></tr></table></figure>

<p>上面两段代码的执行结果，其实是完全一样的。但是其思路完全不一样，第一段代码在未运行时就已经确定了要运行的类（Apple），而第二段代码则是在运行时通过字符串值才得知要运行的类（com.chenshuyi.reflect.Apple）。</p>
<p>所以说什么是反射？</p>
<p><strong>反射就是在运行时才知道要操作的类是什么，并且可以在运行时获取类的完整构造，并调用对应的方法。</strong></p>
<h3 id="动态-SQL"><a href="#动态-SQL" class="headerlink" title="动态 SQL"></a>动态 SQL</h3><p>你可以把 <strong>MyBatis 动态 SQL</strong> 理解为“<strong>在 XML 里写代码，让 SQL 语句按需自动拼接</strong>”</p>
<p>常规使用JDBC拼接sql：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String <span class="keyword">sql</span> <span class="operator">=</span> &quot;select * from t_user where 1=1&quot;;</span><br><span class="line">if (name <span class="operator">!=</span> <span class="keyword">null</span>) <span class="keyword">sql</span> <span class="operator">+</span><span class="operator">=</span> &quot; and name like concat(&#x27;%&#x27;, ?, &#x27;%&#x27;)&quot;;</span><br><span class="line">if (age  <span class="operator">!=</span> <span class="keyword">null</span>) <span class="keyword">sql</span> <span class="operator">+</span><span class="operator">=</span> &quot; and age = ?&quot;;</span><br><span class="line">if (email<span class="operator">!=</span> <span class="keyword">null</span>) <span class="keyword">sql</span> <span class="operator">+</span><span class="operator">=</span> &quot; and email like concat(&#x27;%&#x27;, ?, &#x27;%&#x27;)&quot;;</span><br></pre></td></tr></table></figure>

<p>使用动态sql：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;listUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM t_user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span>   <span class="comment">&lt;!-- 自动处理前缀 AND/OR，去掉多余的 AND --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND name LIKE CONCAT(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null&quot;</span>&gt;</span></span><br><span class="line">            AND age = #&#123;age&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null and email != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND email LIKE CONCAT(&#x27;%&#x27;, #&#123;email&#125;, &#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这是另一个动态sql的例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span>&gt;</span></span><br><span class="line">    DELETE FROM t_user</span><br><span class="line">    WHERE id IN</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;idList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>他等效于这样的sql语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> t_user</span><br><span class="line"><span class="keyword">WHERE</span> id <span class="keyword">IN</span> (<span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>);</span><br></pre></td></tr></table></figure>

<p>实际开发中，90% 的动态 SQL 都是 <code>&lt;if&gt;</code> + <code>&lt;where&gt;</code> + <code>&lt;foreach&gt;</code> 组合，掌握这三个就能解决大部分场景。</p>
<p>然后我们讲一下另一个使用动态SQL的场景，查询。有时候我们会有多种查询方法，通过名称，通过属性，通过ID等等，我们不能为每一个查询条件都写一个方法，而是选择写一个可重用的动态SQL，具体怎么实现呢？举个例子：</p>
<p>假如我们现在要查询菜品，方法一，根据每个条件写一个接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from dish where category_id = #&#123;categoryId&#125;&quot;)</span></span><br><span class="line">List&lt;Dish&gt; <span class="title function_">getByCategoryId</span><span class="params">(Long categoryId)</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Select(&quot;select * from dish where name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)&quot;)</span></span><br><span class="line">List&lt;Dish&gt; <span class="title function_">getByName</span><span class="params">(String name)</span>;</span><br><span class="line"></span><br><span class="line">List&lt;Dish&gt; <span class="title function_">getByCategoryIdAndName</span><span class="params">(Long categoryId, String name)</span>;</span><br></pre></td></tr></table></figure>

<p>可以是可以，但是重用性不高。</p>
<p>方法二，使用一个统一接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Dish&gt; <span class="title function_">list</span><span class="params">(Dish dish)</span>;</span><br></pre></td></tr></table></figure>

<p>怎么实现统一接口呢？答案是<strong>构造一个带有查询条件的Entity对象，把该Entity对象传入接口</strong>！</p>
<p>比较抽象，举个具体例子，假如我们要通过categoryId查询，那我就把构造一个Dish对象，这个对象categoryId字段是我要查询的条件，其他字段留空；如果我要查询categoryId且status是enable，那我就构造一个对象，这个对象categoryId是查询条件，且status是enable：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Setmeal</span>();</span><br><span class="line">setmeal.setCategoryId(categoryId);</span><br><span class="line">setmeal.setStatus(StatusConstant.ENABLE);</span><br><span class="line">List&lt;Setmeal&gt; list = setmealService.list(setmeal);</span><br></pre></td></tr></table></figure>

<p>然后调用mapper查询的时候，动态sql判断传进来的对象每个字段是否为空，如果不为空就代表这个是查询字段，以此为条件进行查询：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.entity.Dish&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.sky.entity.Dish&quot;</span>&gt;</span></span><br><span class="line">    select * from dish</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">            and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span></span><br><span class="line">            and category_id = #&#123;categoryId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">            and status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by create_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>再举一个完整的例子吧，假如查询当前登录用户的所有地址信息：</p>
<p>controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;查询当前登录用户的所有地址信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;AddressBook&gt;&gt; <span class="title function_">list</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">AddressBook</span> <span class="variable">addressBook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AddressBook</span>();</span><br><span class="line">    addressBook.setUserId(BaseContext.getCurrentId());</span><br><span class="line">    List&lt;AddressBook&gt; list = addressBookService.list(addressBook);</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;AddressBook&gt; <span class="title function_">list</span><span class="params">(AddressBook addressBook)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> addressBookMapper.list(addressBook);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mapper.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;AddressBook&gt; <span class="title function_">list</span><span class="params">(AddressBook addressBook)</span>;</span><br></pre></td></tr></table></figure>

<p>mapper.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.sky.entity.AddressBook&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.entity.AddressBook&quot;</span>&gt;</span></span><br><span class="line">    select * from address_book</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userId != null&quot;</span>&gt;</span></span><br><span class="line">            and user_id = #&#123;userId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null&quot;</span>&gt;</span></span><br><span class="line">            and phone = #&#123;phone&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;isDefault != null&quot;</span>&gt;</span></span><br><span class="line">            and is_default = #&#123;isDefault&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里就构造一个AddressBook对象，对象除了userId，其他字段都留空。把这个对象传给mapper。动态sql判断这个对象哪些字段不为空就以哪些字段为查询条件，这里userId不为空，那么<code>where user_id = #&#123;userId&#125;</code>。</p>
<h2 id="day1-2-整体介绍"><a href="#day1-2-整体介绍" class="headerlink" title="day1-2 整体介绍"></a>day1-2 整体介绍</h2><p><img src="/.io//image-20250715094709593.png"></p>
<p>需求分析：需求规格说明书，产品原型（一个静态html页面展示）</p>
<p><img src="/.io//image-20250715094833193.png"></p>
<h2 id="day1-3-项目介绍"><a href="#day1-3-项目介绍" class="headerlink" title="day1-3 项目介绍"></a>day1-3 项目介绍</h2><h3 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h3><p><img src="/.io//image-20250715095202103.png"></p>
<h3 id="产品原型"><a href="#产品原型" class="headerlink" title="产品原型"></a>产品原型</h3><p><img src="/.io//image-20250715095326804.png"></p>
<p><img src="/.io//image-20250715095339569.png"></p>
<h3 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h3><p><img src="/.io//image-20250715100010916.png"></p>
<p><img src="/.io//image-20250716084314492.png"></p>
<h2 id="day1-4-前端环境搭建"><a href="#day1-4-前端环境搭建" class="headerlink" title="day1-4 前端环境搭建"></a>day1-4 前端环境搭建</h2><p>前端基于nginx服务器。</p>
<p><img src="/.io//image-20250716084811064.png"></p>
<p>运行方式：双击nginx.exe，然后浏览器打开<a target="_blank" rel="noopener" href="http://localhost/#/login">苍穹外卖</a>。</p>
<h2 id="day1-5-后端环境搭建-DTO-VO"><a href="#day1-5-后端环境搭建-DTO-VO" class="headerlink" title="day1-5 后端环境搭建 (DTO, VO)"></a>day1-5 后端环境搭建 (DTO, VO)</h2><p><img src="/.io//image-20250716085652911.png"></p>
<p><img src="/.io//image-20250716085826015.png"></p>
<p>DTO（Data Transfer Object）：前端传给后端的请求体封装为DTO</p>
<p>VO（Value Object）：后端发回给前端的相应封装为VO</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">    class 前端 &#123;</span><br><span class="line">        + 发送请求(JSON body)</span><br><span class="line">        + 接收响应(JSON)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class 后端 &#123;</span><br><span class="line">        + @PostMapping(&quot;/login&quot;)</span><br><span class="line">        + login(employeeLoginDTO)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class DTO &#123;</span><br><span class="line">        &lt;&lt;数据传输对象&gt;&gt;</span><br><span class="line">        + username</span><br><span class="line">        + password</span><br><span class="line">        __接收前端请求体__</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class VO &#123;</span><br><span class="line">        &lt;&lt;视图对象&gt;&gt;</span><br><span class="line">        + id</span><br><span class="line">        + userName</span><br><span class="line">        + token</span><br><span class="line">        __返回前端响应__</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class Entity &#123;</span><br><span class="line">        &lt;&lt;持久化实体&gt;&gt;</span><br><span class="line">        + id</span><br><span class="line">        + username</span><br><span class="line">        + password</span><br><span class="line">        + name</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    class 数据库 &#123;</span><br><span class="line">        + employee表</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    前端 --&gt; 后端 : HTTP请求(包含JSON body)</span><br><span class="line">    后端 --&gt; 前端 : HTTP响应(包含VO JSON)</span><br><span class="line">    后端 --&gt; DTO : @RequestBody接收</span><br><span class="line">    后端 --&gt; VO : 构造响应数据</span><br><span class="line">    DTO --&gt; Entity : 转换(用于业务处理)</span><br><span class="line">    Entity --&gt; VO : 转换(构建响应)</span><br><span class="line">    Entity --&gt; 数据库 : ORM操作</span><br><span class="line">    数据库 --&gt; Entity : 查询结果</span><br></pre></td></tr></table></figure>



<h2 id="day1-6-Git"><a href="#day1-6-Git" class="headerlink" title="day1-6 Git"></a>day1-6 Git</h2><p>Git分为本地和远程仓库，先配置本地仓库。</p>
<p>打开浏览器访问官网：<a target="_blank" rel="noopener" href="https://git-scm.com/%E4%B8%8B%E8%BD%BDGit%E5%B9%B6%E5%AE%89%E8%A3%85%E3%80%82">https://git-scm.com/下载Git并安装。</a></p>
<p>在IDEA配置Git路径：</p>
<p><img src="/.io//image-20250716091554151.png"></p>
<p>IDEA顶部菜单栏，VCS（版本控制系统）。点进去创建Git仓库：</p>
<p><img src="/.io//image-20250716090542490.png"></p>
<p>创建完成后左上角可以进行Git操作：</p>
<p><img src="/.io//image-20250716091502239.png"></p>
<p>在Github创建仓库，并复制下面的地址：</p>
<p><img src="/.io//image-20250716091859672.png"></p>
<p>IDEA中选择推送，再点击定义远程（Define Remote）：</p>
<p><img src="/.io//image-20250716091945873.png"></p>
<p>如果添加了错误的远程仓库，可以在左侧项目栏中右键项目目录，然后：Git，管理远程。</p>
<p><img src="/.io//image-20250716093902657.png"></p>
<p>粘贴上面复制的ssh地址：</p>
<p><img src="/.io//image-20250716094005669.png"></p>
<p>如果没有配置公钥，需要先配置公钥：</p>
<p><img src="/.io//image-20250716094031550.png"></p>
<p>然后在Github中点击设置，在ssh一栏中添加公钥。</p>
<p>现在再进入IDEA推送页面，页面如下所示：</p>
<p><img src="/.io//image-20250716094204927.png"></p>
<p>点击推送即可。</p>
<p><img src="/.io//image-20250716094508378.png"></p>
<p>推送成功。</p>
<h2 id="day1-7-数据库环境搭建MySQL"><a href="#day1-7-数据库环境搭建MySQL" class="headerlink" title="day1-7 数据库环境搭建MySQL"></a>day1-7 数据库环境搭建MySQL</h2><p>首先安装MySQL，<a target="_blank" rel="noopener" href="https://dev.mysql.com/downloads/installer/">MySQL :: Download MySQL Installer</a>，选择下面的下载：</p>
<p><img src="/.io//image-20250716095500640.png"></p>
<p>端口设置：</p>
<p><img src="/.io//image-20250716100056746.png"></p>
<p>密码设置：123456。	Windows服务名称：MySQL80。</p>
<p>安装完毕后从命令行进入 <code>mysqlsh</code>：</p>
<p><img src="/.io//image-20250716100453474.png"></p>
<p>连接数据库：</p>
<p><img src="/.io//image-20250716100620438.png"></p>
<p>接下来就可以在这里写 sql 建表语句了。之后我们在IDEA配置数据源，点击右侧工具栏的数据库图标：</p>
<p><img src="/.io//image-20250716101139918.png"></p>
<p>配置drivers：</p>
<p><img src="/.io//image-20250716101330424.png"></p>
<p>配置数据源：</p>
<p><img src="/.io//image-20250716101410154.png"></p>
<p>或者也可以不在 <code>mysqlsh</code> 写sql，直接在IDEA运行：</p>
<p><img src="/.io//image-20250716101932220.png"></p>
<h2 id="day1-8-前后端联调"><a href="#day1-8-前后端联调" class="headerlink" title="day1-8 前后端联调"></a>day1-8 前后端联调</h2><p>在右侧maven工具栏中，对root进行编译，这样对四个模块都会进行编译。</p>
<p><img src="/.io//image-20250716102116662.png"></p>
<p>启动sky-server的SkyApplication。启动之前记得修改yaml中的sql账号密码端口号：</p>
<p><img src="/.io//image-20250716102637161.png"></p>
<p>启动后，即可在<a target="_blank" rel="noopener" href="http://localhost/#/dashboard">工作台</a>进行登录。admin，123456。即可登录。登录截图略。</p>
<h2 id="day1-9-Nginx"><a href="#day1-9-Nginx" class="headerlink" title="day1-9 Nginx"></a>day1-9 Nginx</h2><p>什么是代理：<strong>proxy（代理）</strong> 指的是一种<strong>中间服务器</strong>，它位于客户端和目标服务器之间，<strong>代替客户端向目标服务器发送请求</strong>，然后再把服务器的响应返回给客户端。</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
</tr>
</thead>
<tbody><tr>
<td><strong>正向代理（Forward Proxy）</strong></td>
<td>客户端使用代理访问外部资源，目标服务器看不到真实客户端。</td>
</tr>
<tr>
<td><strong>反向代理（Reverse Proxy）</strong></td>
<td>客户端不知道后端服务器的存在，代理接收请求并转发到后端服务器（如 Nginx）。</td>
</tr>
</tbody></table>
<p>什么是 Nginx 反向代理：前端不直接向后端发出请求而是找Nginx。你不直接访问真实的服务器，而是先找中介Nginx，由它转发请求、拿到结果后再转交给你。</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">80</span>;             <span class="comment"># 监听80端口，这是HTTP服务的默认端口</span></span><br><span class="line">    <span class="attribute">server_name</span> localhost; <span class="comment"># 指定服务器名称为localhost</span></span><br><span class="line"></span><br><span class="line">    <span class="section">location</span> /api/ &#123;       <span class="comment"># 定义一个location块，匹配以/api/开头的请求</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://localhost:8080/admin/; <span class="comment"># 设置反向代理，将请求转发到本地的8080端口上的/admin/路径</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面这段代码的含义：将前端80端口以api开头的请求，转发给后端8080的admin路径上。</p>
<p><img src="/.io//image-20250717100254502.png"></p>
<p>Nginx还能实现负载均衡，可以把请求分给不同服务器处理：</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="section">upstream</span> my_backend &#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:8081</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">127.0.0.1:8082</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="attribute">listen</span> <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span> localhost;</span><br><span class="line"></span><br><span class="line">        <span class="section">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://my_backend;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> Host <span class="variable">$host</span>;</span><br><span class="line">            <span class="attribute">proxy_set_header</span> X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="day1-11-完善登录密码加密"><a href="#day1-11-完善登录密码加密" class="headerlink" title="day1-11 完善登录密码加密"></a>day1-11 完善登录密码加密</h2><p>密码不能够明文存储。使用MD5进行加密。MD5加密不可逆，密码比对只能对密文进行比对。</p>
<p>Java代码修改如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//密码比对</span></span><br><span class="line">password = DigestUtils.md5DigestAsHex(password.getBytes());</span><br><span class="line"><span class="keyword">if</span> (!password.equals(employee.getPassword())) &#123;</span><br><span class="line">    <span class="comment">//密码错误</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">PasswordErrorException</span>(MessageConstant.PASSWORD_ERROR);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后把数据库中密码改成md5密文。</p>
<h2 id="day1-12-导入接口文档-YApi"><a href="#day1-12-导入接口文档-YApi" class="headerlink" title="day1-12 导入接口文档  YApi"></a>day1-12 导入接口文档  YApi</h2><p><img src="/.io//image-20250717101655510.png"></p>
<p><strong>YApi</strong> 是一个<strong>可视化接口管理平台</strong>，它是由腾讯开源的，主要用于 API 文档管理、接口调试、团队协作等。</p>
<p>首先登录网址 <a target="_blank" rel="noopener" href="https://yapi.pro/">YApi</a></p>
<p>创建项目：</p>
<p><img src="/.io//image-20250717102324880.png"></p>
<p>进入项目，点击数据管理，导入接口文档（支持json，swagger等等）</p>
<h2 id="day1-13-Swagger"><a href="#day1-13-Swagger" class="headerlink" title="day1-13 Swagger"></a>day1-13 Swagger</h2><p><strong>Knife4j</strong> 是一个用于 <strong>生成和增强 API 文档的工具</strong>，它基于 <strong>Swagger</strong>，是 Swagger 的一个增强 UI 实现。</p>
<p>使用方法：</p>
<p>第一步，maven配置：略</p>
<p>第二步，配置类中配置knife4j：最重要的就是RequestHandlerSelectors.basePackage(“com.sky.controller”)，制定了扫描的包：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过knife4j生成接口文档</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ApiInfo</span> <span class="variable">apiInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">        .title(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">        .version(<span class="string">&quot;2.0&quot;</span>)</span><br><span class="line">        .description(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">    <span class="type">Docket</span> <span class="variable">docket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">        .apiInfo(apiInfo)</span><br><span class="line">        .select()</span><br><span class="line">        .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sky.controller&quot;</span>))</span><br><span class="line">        .paths(PathSelectors.any())</span><br><span class="line">        .build();</span><br><span class="line">    <span class="keyword">return</span> docket;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步，设置静态资源映射：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置静态资源映射</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registry</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">    registry.addResourceHandler(<span class="string">&quot;/doc.html&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/&quot;</span>);</span><br><span class="line">    registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>).addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问：<a target="_blank" rel="noopener" href="http://localhost:8080/doc.html#/home">苍穹外卖项目接口文档</a></p>
<p><img src="/.io//image-20250717103847923.png"></p>
<table>
<thead>
<tr>
<th>阶段</th>
<th>Swagger 用于做什么</th>
<th>YApi 用于做什么</th>
</tr>
</thead>
<tbody><tr>
<td>接口设计阶段（前）</td>
<td>❌（不适合）</td>
<td>✅ 可手动创建接口、模拟返回，前端可提前开发</td>
</tr>
<tr>
<td>后端开发中</td>
<td>✅ 自动生成接口文档，方便开发者查看</td>
<td>❌ 一般此时不是主要工具（除非需要共享接口）</td>
</tr>
<tr>
<td>前后端联调阶段</td>
<td>✅ 配合 Knife4j 可调试接口、查看字段</td>
<td>✅ Mock 接口 + 文档共享 + 接口测试，前端&#x2F;测试可独立使用</td>
</tr>
</tbody></table>
<h2 id="day1-14-Swagger常用注解"><a href="#day1-14-Swagger常用注解" class="headerlink" title="day1-14 Swagger常用注解"></a>day1-14 Swagger常用注解</h2><p><img src="/.io//image-20250717104449264.png"></p>
<table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
<th>位置</th>
<th>示例用法</th>
</tr>
</thead>
<tbody><tr>
<td><code>@Api</code></td>
<td>定义一个 Controller，给接口类加注释</td>
<td>类上</td>
<td><code>@Api(tags=&quot;用户管理&quot;)</code></td>
</tr>
<tr>
<td><code>@ApiOperation</code></td>
<td>说明一个接口的用途</td>
<td>Controller 方法上</td>
<td><code>@ApiOperation(&quot;查询用户列表&quot;)</code></td>
</tr>
<tr>
<td><code>@ApiParam</code></td>
<td>描述方法参数的意义</td>
<td>方法参数上</td>
<td><code>@ApiParam(value=&quot;用户ID&quot;, required=true)</code></td>
</tr>
<tr>
<td><code>@ApiModel</code></td>
<td>用于实体类，说明实体含义</td>
<td>实体类上</td>
<td><code>@ApiModel(&quot;用户实体&quot;)</code></td>
</tr>
<tr>
<td><code>@ApiModelProperty</code></td>
<td>描述实体类字段</td>
<td>实体类字段上</td>
<td><code>@ApiModelProperty(&quot;用户名&quot;)</code></td>
</tr>
<tr>
<td><code>@ApiResponses</code></td>
<td>描述多个响应信息</td>
<td>Controller 方法上</td>
<td>包含多个 <code>@ApiResponse</code></td>
</tr>
<tr>
<td><code>@ApiResponse</code></td>
<td>描述单个响应信息</td>
<td><code>@ApiResponses</code> 内部</td>
<td><code>code=200, message=&quot;请求成功&quot;</code></td>
</tr>
<tr>
<td><code>@ApiIgnore</code></td>
<td>忽略该接口或参数</td>
<td>类、方法、参数上</td>
<td><code>@ApiIgnore</code></td>
</tr>
</tbody></table>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ApiModel(description = &quot;员工登录时传递的数据模型&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeLoginDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;用户名&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(&quot;密码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;员工退出&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">logout</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加完注解，接口文档中tag会变成注解的文字：</p>
<p><img src="/.io//image-20250717105224071.png"></p>
<h2 id="day2-1-新增员工-需求分析与设计"><a href="#day2-1-新增员工-需求分析与设计" class="headerlink" title="day2-1 新增员工-需求分析与设计"></a>day2-1 新增员工-需求分析与设计</h2><p>需求分析往往对着<strong>产品原型</strong>进行分析：</p>
<p><img src="/.io//image-20250717105617310.png"></p>
<p>接下来进行<strong>接口设计</strong>：添加员工使用POST比较合适，使用json传递数据。</p>
<p><img src="/.io//image-20250717105722103.png"></p>
<p><em>注：前端返回的msg是用于创建失败时候的提示弹窗。管理端url用admin前缀，用户端user前缀。</em></p>
<p>接口设计完毕进行<strong>数据库设计</strong>：</p>
<p><img src="/.io//image-20250717110316917.png"></p>
<h2 id="day2-2-新增员工-代码开发-Lombok-implements-Serializable"><a href="#day2-2-新增员工-代码开发-Lombok-implements-Serializable" class="headerlink" title="day2-2 新增员工-代码开发 (Lombok, implements Serializable)"></a>day2-2 新增员工-代码开发 (Lombok, implements Serializable)</h2><p>现在我们需要设计DTO。当然也可以直接用Employee类进行接收，但是由于Employee有很多前端用不到的属性，因此封装为DTO。DTO的字段是根据前面<strong>接口设计</strong>中Body的字段确定的。</p>
<p>DTO代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Builder;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String idNumber;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long createUser;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long updateUser;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>让我们来解释一些东西：</p>
<p>首先是Lombok。Lombok是一个 Java 库，它通过使用注解来简化 Java 代码的编写。它提供了一系列的注解，用于自动生成常见的代码，如<code>getter</code>和<code>setter</code>方法、构造函数、<code>equals</code>和<code>hashCode</code>方法等，以减少开发者的重复劳动。Lomlok可以在maven中引入依赖使用。</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td><code>@Data</code></td>
<td>自动生成 getter&#x2F;setter、toString、equals、hashCode</td>
</tr>
<tr>
<td><code>@ToString</code></td>
<td>自动生成 <code>toString()</code> 方法</td>
</tr>
<tr>
<td><code>@NoArgsConstructor</code></td>
<td>自动生成无参构造方法</td>
</tr>
<tr>
<td><code>@AllArgsConstructor</code></td>
<td>自动生成全参构造方法</td>
</tr>
<tr>
<td><code>@Builder</code></td>
<td>生成建造者模式代码（Builder Pattern）</td>
</tr>
<tr>
<td><code>@Slf4j</code></td>
<td>自动生成 <code>private static final Logger log</code> 日志对象</td>
</tr>
<tr>
<td><code>@Value</code></td>
<td>不可变对象类（final + private + 只读）</td>
</tr>
</tbody></table>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Builder 用法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> Employee.builder()</span><br><span class="line">        .id(<span class="number">1L</span>)</span><br><span class="line">        .name(<span class="string">&quot;张三&quot;</span>)</span><br><span class="line">        .email(<span class="string">&quot;zhangsan@example.com&quot;</span>)</span><br><span class="line">        .build();</span><br></pre></td></tr></table></figure>

<p>然后是序列化，Java中的实体类为什么要 <code>implements Serializable</code>?</p>
<p>序列化：把对象转换为字节序列的过程称为对象的序列化。反序列化：把字节序列恢复为对象的过程称为对象的反序列化。</p>
<p>序列化操作用于存储时，一般是对于 NoSql 数据库，而在使用 Nosql 数据库进行存储时，如 <strong>redis</strong>，它就没有 varchar，int 之类的数据结构。 而在没有的情况下，我们又确实需要进行存储，那么我们就需要将对象进行序列化。</p>
<p>为什么要显示声明 serialVersionUID？</p>
<p>serialVersionUID 的作用是验证序列化和反序列化的过程中，对象是否保持一致。所以在一般情况下我们需要显示的声明serialVersionUID。如果接受者加载的该对象的类的 serialVersionUID 和发送者的类版本号不同的话，反序列化会爆出 InvalidClassException 错误。</p>
<p><img src="/.io//image-20250717112532828.png"></p>
<p>解释完DTO，还有一个东西需要解释。看上面的接口文档，看返回数据，这个对应着我们sky-common模块下的Result类（sky-common&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;sky&#x2F;result&#x2F;Result.java），这个类也就是后端统一返回结果。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer code; <span class="comment">//编码：1成功，0和其它数字为失败</span></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//错误信息</span></span><br><span class="line">    <span class="keyword">private</span> T data; <span class="comment">//数据</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">()</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">(T object)</span> &#123;</span><br><span class="line">        Result&lt;T&gt; result = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;T&gt;();</span><br><span class="line">        result.data = object;</span><br><span class="line">        result.code = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">error</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Result</span>();</span><br><span class="line">        result.msg = msg;</span><br><span class="line">        result.code = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也就是，请求参数Body对应着DTO，返回数据对应着Result。</p>
<p>现在开始写代码，<strong>首先写控制器</strong>，控制器的参数是DTO，控制器的返回值是Result对象。这里我们没有返回Data，所以直接返回<code>Result.success()</code>也就是只有code和msg。（观察Result类代码可以知道，这里<code>success()</code>方法返回的是一个Result的对象）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping()</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;新增员工&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeDTO employeeDTO)</span>&#123;</span><br><span class="line">    log.info(<span class="string">&quot;新增员工：&#123;&#125;&quot;</span>,employeeDTO);</span><br><span class="line">    employeeService.save(employeeDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制器调用service接口，因此先在<strong>service</strong>中加上我们需要的接口，然后在implement中进行实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">    <span class="comment">//对象属性拷贝</span></span><br><span class="line">    BeanUtils.copyProperties(employeeDTO,employee);</span><br><span class="line">    employee.setStatus(StatusConstant.ENABLE);</span><br><span class="line">    employee.setPassword(DigestUtils.md5DigestAsHex(PasswordConstant.DEFAULT_PASSWORD.getBytes()));</span><br><span class="line">    employee.setCreateTime(LocalDateTime.now());</span><br><span class="line">    employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    <span class="comment">// TODO 后期需要改为当前登录用户ID</span></span><br><span class="line">    employee.setCreateUser(<span class="number">10L</span>);</span><br><span class="line">    employee.setUpdateUser(<span class="number">10L</span>);</span><br><span class="line"></span><br><span class="line">    employeeMapper.insert(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service又需要通过mapper进行插入，因此要在<strong>mapper</strong>中加入insert方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;INSERT INTO employee(name, username, password, phone, sex, id_number, create_time, update_time, create_user, update_user) &quot; +</span></span><br><span class="line"><span class="meta">        &quot;VALUES(#&#123;name&#125;, #&#123;username&#125;, #&#123;password&#125;, #&#123;phone&#125;, #&#123;sex&#125;, #&#123;idNumber&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;, #&#123;createUser&#125;, #&#123;updateUser&#125;)&quot;)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure>



<h2 id="day2-3-新增员工-测试"><a href="#day2-3-新增员工-测试" class="headerlink" title="day2-3 新增员工-测试"></a>day2-3 新增员工-测试</h2><p>两种后端测试方式：Swagger，前后端联调。开发阶段以 Swagger 测试为主。</p>
<p>注意，我们现在直接进行测试是会返回401的，因为在com&#x2F;sky&#x2F;interceptor&#x2F;JwtTokenAdminInterceptor.java中定义了JWT令牌的拦截器，我们当前令牌为空，因此返回401异常。解决方案：在“员工登录”这里调试，并获取返回的token：</p>
<p><img src="/.io//image-20250717150709669.png"></p>
<p>然后把复制下来的token放在全局参数中即可。</p>
<p><img src="/.io//image-20250717150907176.png"></p>
<p>现在直接调试就可以成功了。</p>
<p>当然我们现在也可以进行前后端联调，测试也通过。</p>
<p><strong>注意！！！JWT令牌是有有效期的，可能隔一段时间我们再用这个令牌操作就失效了！这个时候按照前面操作再生成即可</strong></p>
<h2 id="day2-4-新增员工-增加相同用户异常处理"><a href="#day2-4-新增员工-增加相同用户异常处理" class="headerlink" title="day2-4 新增员工-增加相同用户异常处理"></a>day2-4 新增员工-增加相同用户异常处理</h2><p>如果我们新增一个相同的员工，状态码500：</p>
<p><img src="/.io//image-20250717152046848.png"></p>
<p>IDEA终端出现异常：<code>java.sql.SQLIntegrityConstraintViolationException: Duplicate entry &#39;zhang&#39; for key &#39;employee.idx_username&#39;</code></p>
<p>com&#x2F;sky&#x2F;handler&#x2F;GlobalExceptionHandler.java是我们处理异常的类，在这里添加一个方法用来处理SQL异常：</p>
<p>注意传入的参数就是上面的SQL异常类，通过Duplicate entry关键字识别进行用户友好提示。注意有些异常提示已经封装为常量，尽量避免直接写字符串。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Result <span class="title function_">exceptionHandler</span><span class="params">(SQLIntegrityConstraintViolationException ex)</span>&#123;</span><br><span class="line">    String msg=ex.getMessage();</span><br><span class="line">    log.error(<span class="string">&quot;异常信息：&#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">    <span class="keyword">if</span>(msg.contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;</span><br><span class="line">        String[] tmp=msg.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        String username=tmp[<span class="number">2</span>];</span><br><span class="line">        String errMsg=username+<span class="string">&quot; 已存在&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> Result.error(errMsg);</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.error(MessageConstant.UNKNOWN_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在如果再新增一个相同的员工，状态码就会是200，且返回用户友好的信息。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&#x27;zhang&#x27; 已存在&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h2 id="day2-5-新增员工-创建人修改人ID替换-ThreadLocal"><a href="#day2-5-新增员工-创建人修改人ID替换-ThreadLocal" class="headerlink" title="day2-5 新增员工-创建人修改人ID替换 (ThreadLocal)"></a>day2-5 新增员工-创建人修改人ID替换 (ThreadLocal)</h2><p>注意一个概念，Tomcat中，<strong>客户端每发起一次请求就是一个新的线程</strong>。</p>
<p>当客户端发起 HTTP 请求时，服务器为了并发处理，会为这个请求分配一个线程来处理它（通常是线程池中的一个线程）。这个线程会处理业务逻辑、数据库、响应输出等任务。服务端会<strong>为每个请求分配一个线程（或复用线程池中的线程）</strong>来处理它，彼此互不干扰，支持并发。</p>
<p><code>ThreadLocal</code> 是 Java 提供的一种<strong>线程局部变量</strong>，就像是每个线程都有一个自己的空间，放进去的变量<strong>只有当前线程能看见、能拿出来用</strong>，其他线程完全无法访问。</p>
<p><code>ThreadLocal</code> 通常有下面的作用：</p>
<table>
<thead>
<tr>
<th>场景</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>用户登录上下文</td>
<td>每个请求绑定当前用户 ID、Token，存在线程中</td>
</tr>
<tr>
<td>数据库事务管理</td>
<td>保存每个线程独立的数据库连接对象</td>
</tr>
<tr>
<td>日志跟踪</td>
<td>将 traceId 绑定到线程中，贯穿调用链</td>
</tr>
<tr>
<td>请求上下文传递</td>
<td>Spring 的 <code>RequestContextHolder</code> 就是用的 <code>ThreadLocal</code></td>
</tr>
</tbody></table>
<p><strong>登录后想保存当前用户的 ID，让业务层可以随时访问</strong>。这就是一个 <code>ThreadLocal</code> 常见的应用场景，他可以做到存储一个线程的上下文的作用。</p>
<p>在我们项目的com&#x2F;sky&#x2F;context&#x2F;BaseContext.java中，封装了 <code>ThreadLocal</code> 的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseContext</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ThreadLocal&lt;Long&gt; threadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setCurrentId</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        threadLocal.set(id);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getCurrentId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> threadLocal.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">removeCurrentId</span><span class="params">()</span> &#123;</span><br><span class="line">        threadLocal.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了在当前线程共享当前登录用户的ID，我们可以从JWT中拿到用户ID，存在ThreadLocal变量中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">log.info(<span class="string">&quot;jwt校验:&#123;&#125;&quot;</span>, token);</span><br><span class="line"><span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseJWT(jwtProperties.getAdminSecretKey(), token);</span><br><span class="line"><span class="type">Long</span> <span class="variable">empId</span> <span class="operator">=</span> Long.valueOf(claims.get(JwtClaimsConstant.EMP_ID).toString());</span><br><span class="line">log.info(<span class="string">&quot;当前员工id：&quot;</span>, empId);</span><br><span class="line">BaseContext.setCurrentId(empId);</span><br></pre></td></tr></table></figure>

<p>最后，在service中把该变量取出，赋值即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">employee.setCreateUser(BaseContext.getCurrentId());</span><br><span class="line">employee.setUpdateUser(BaseContext.getCurrentId());</span><br></pre></td></tr></table></figure>

<p>测试发现可以正常新增，且修改人ID正确。新增员工开发完毕，别忘了Git Push。</p>
<h2 id="day2-6-员工分页查询-需求分析与设计"><a href="#day2-6-员工分页查询-需求分析与设计" class="headerlink" title="day2-6 员工分页查询-需求分析与设计"></a>day2-6 员工分页查询-需求分析与设计</h2><p><img src="/.io//image-20250717155509626.png"></p>
<p><img src="/.io//image-20250717155751444.png"></p>
<h2 id="day2-7-员工分页查询-代码开发-PageHelper-MyBatis动态SQL与XML配置"><a href="#day2-7-员工分页查询-代码开发-PageHelper-MyBatis动态SQL与XML配置" class="headerlink" title="day2-7 员工分页查询-代码开发 (PageHelper, MyBatis动态SQL与XML配置)"></a>day2-7 员工分页查询-代码开发 (PageHelper, MyBatis动态SQL与XML配置)</h2><p>老规矩，DTO对应着接口的请求参数Query（前面是POST请求，是Body，这里是GET请求，是Query），Result对应着接口的返回值。</p>
<p>DTO代码，和上面的Query字段完全一致：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeePageQueryDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> page;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> pageSize;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至于Result，由于这里由于是分页查询，我们在sky-common&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;sky&#x2F;result包中还封装了PageResult类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResult</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> total; <span class="comment">//总记录数</span></span><br><span class="line">    <span class="keyword">private</span> List records; <span class="comment">//当前页数据集合</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code; <span class="comment">//编码：1成功，0和其它数字为失败</span></span><br><span class="line">    <span class="keyword">private</span> String msg; <span class="comment">//错误信息</span></span><br><span class="line">    <span class="keyword">private</span> T data; <span class="comment">//数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之前的Result类正好对应着我们接口返回值，Result中的data正好对应着PageResult类。这样的话，Result的泛型就是PageResult也就是：<code>Result&lt;PageResult&gt;</code>。</p>
<p>确定了参数（<code>EmployeePageQueryDTO</code>）和返回值（<code>Result&lt;PageResult&gt;</code>），我们就可以开始写controller了（注意，这里是Query，不是json请求，不需要写@RequestBody注解）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;员工分页查询&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span>&#123;</span><br><span class="line">    PageResult pageResult=employeeService.pageQuary(employeePageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>至此我们controller就写好了，不过service的pageQuary方法还没写。</p>
<p>其实你会发现，controller是很好写的，只是明确参数和返回值，调用一下service，构造一下结果就可以了。至于具体实现，那是service干的事情。</p>
<p><em>（我在写到这的时候有一个疑问，我们是怎么直接拿到employeeService对象的？答案是employeeService对象是EmployeeController的private字段，并加上了@Autowired注解，同时service的实现类需要加上@Service注解）</em></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmployeeService employeeService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>（其实controller和service的关系，和service与mapper的关系一样，mapper要加上@Mapper注解，同时在service类中自动注入mapper）</em></p>
<p>OK，下面开始实现service：</p>
<p>在实现service之前先介绍一个用于实现分页的插件：PageHelper ，它可以自动为你的 SQL 查询添加分页语句（LIMIT 语句），让你只写一条查询语句就能实现分页。该插件需要通过maven进行引入。</p>
<p>假设你有个用户表，想分页查询用户列表（每页 10 条），传统写法要手动拼接 <code>LIMIT</code> 语句，很麻烦，PageHelper 就无需这么麻烦。</p>
<p>service代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(EmployeePageQueryDTO employeePageQueryDTO)</span> &#123;</span><br><span class="line">    PageHelper.startPage(employeePageQueryDTO.getPage(),employeePageQueryDTO.getPageSize());</span><br><span class="line">    Page&lt;Employee&gt; page=employeeMapper.pageQuery(employeePageQueryDTO);</span><br><span class="line">    <span class="type">long</span> total=page.getTotal();</span><br><span class="line">    List&lt;Employee&gt; records=page.getResult();</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(total,records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来让我们实现mapper的pageQuery方法：</p>
<p>实现mapper之前，让我们介绍一下动态SQL。动态 SQL 就是写一段“会变”的 SQL，具体内容根据参数、逻辑在运行时自动拼出来的。MyBatis 提供了一套标签实现动态SQL，我们可以尽量把 SQL 逻辑放在 XML 中。</p>
<p>在一个 标准的 Java Web 项目（MyBatis）中，<strong>XML文件（Mapper 映射文件）</strong>的放置位置如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">├── main</span><br><span class="line">│   ├── java</span><br><span class="line">│   │   └── com.example.project</span><br><span class="line">│   │       └── mapper</span><br><span class="line">│   │           └── EmployeeMapper.java   &lt;-- 接口</span><br><span class="line">│   └── resources</span><br><span class="line">│       └── mapper</span><br><span class="line">│           └── EmployeeMapper.xml        &lt;-- XML 映射文件</span><br></pre></td></tr></table></figure>

<p>当然，Spring Boot 项目通常使用 <code>application.yml</code> 配置 MyBatis 路径。</p>
<p>在我们现在要实现的分页查询中，我们使用动态SQL，而不再使用注解的方式，因此需要使用xml映射文件：</p>
<p>该项目xml在<code>sky-server/src/main/resources/mapper/EmployeeMapper.xml</code>中。</p>
<p>首先我们回到mapper，把pageQuery方法创建，并右键点击生成：</p>
<p><img src="/.io//image-20250717165022220.png"></p>
<p>最终xml如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.entity.Employee&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">parameterType</span>=<span class="string">&quot;com.sky.dto.EmployeePageQueryDTO&quot;</span>&gt;</span></span><br><span class="line">        select * from employee</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null and name!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        order by create_time desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>那么上面的代码是怎么实现分页的呢？</p>
<p>PageHelper 是 MyBatis 的分页插件，<strong>通过拦截器机制拦截你的查询语句，并自动在 SQL 后面加上分页的 LIMIT 子句</strong>。</p>
<p><code>PageHelper.startPage(...)</code> 会启用分页上下文；MyBatis 执行 SQL 时，PageHelper 的拦截器就会捕捉到这个 SQL；然后插件会在末尾加上 <code>limit ? offset ?</code>，最后结果封装为 <code>Page&lt;T&gt;</code> 返回。<em>（PageHelper也是基于ThreadLocal实现的）</em></p>
<p><em>OK，总结一下，一个功能需求实现的步骤就是：接口文档，DTO和Result，控制器，service，mapper，测试，异常处理与其他。</em></p>
<h2 id="day2-9-员工分页查询-完善日期显示-序列化-反序列化-消息转换"><a href="#day2-9-员工分页查询-完善日期显示-序列化-反序列化-消息转换" class="headerlink" title="day2-9 员工分页查询-完善日期显示 (序列化, 反序列化, 消息转换)"></a>day2-9 员工分页查询-完善日期显示 (序列化, 反序列化, 消息转换)</h2><p>时间显示格式有问题，需要修改。</p>
<p>sky-common&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;sky&#x2F;json&#x2F;JacksonObjectMapper.java，一个自定义的 Jackson 配置类，用于<strong>控制 Java 对象和 JSON 之间的转换格式</strong>，尤其是 时间类（<code>LocalDate</code>、<code>LocalTime</code>、<code>LocalDateTime</code>）的序列化与反序列化格式。</p>
<p><strong>序列化（Serialization）</strong>：把 Java 对象 ➜ 转换为字节流（例如保存到文件、传输给网络）</p>
<p><strong>反序列化（Deserialization）</strong>：把字节流 ➜ 转换回 Java 对象。</p>
<p>在com&#x2F;sky&#x2F;config&#x2F;WebMvcConfiguration.java中添加如下语句：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">    MappingJackson2HttpMessageConverter converter=<span class="keyword">new</span> <span class="title class_">MappingJackson2HttpMessageConverter</span>();</span><br><span class="line">    converter.setObjectMapper(<span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>());</span><br><span class="line">    converters.add(<span class="number">0</span>,converter);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码是 Spring MVC 中的一种配置方式，用于<strong>扩展 Spring 的消息转换器</strong>（MessageConverter），实现 <strong>自定义对象序列化和反序列化的行为</strong>。</p>
<p>在JacksonObjectMapper中（也就是上面提到的自定义Jackson配置类）就可以写日期转换逻辑，具体逻辑略。</p>
<h2 id="day2-10-启用禁用-需求分析与设计"><a href="#day2-10-启用禁用-需求分析与设计" class="headerlink" title="day2-10 启用禁用-需求分析与设计"></a>day2-10 启用禁用-需求分析与设计</h2><p>原型与需求：</p>
<p><img src="/.io//image-20250717192046159.png"></p>
<p><img src="/.io//image-20250717192146928.png"></p>
<p>接口：</p>
<p><img src="/.io//image-20250717191606532.png"></p>
<p>注意，<code>&#123;status&#125;</code>：这是一个路径参数，表示在实际请求时，需要将这个占位符替换为具体的员工状态值。例如，如果员工的状态是1，那么完整的url将是 <code>/admin/employee/status/1</code>。</p>
<h2 id="day2-11-启用禁用-代码开发与测试"><a href="#day2-11-启用禁用-代码开发与测试" class="headerlink" title="day2-11 启用禁用-代码开发与测试"></a>day2-11 启用禁用-代码开发与测试</h2><p>对于路径参数，我们需要使用@PathVariable注解来获取路径参数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;启用禁用员工账号&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status, Long id)</span>&#123;</span><br><span class="line">    employeeService.startOrStop(status, id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现service方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">startOrStop</span><span class="params">(Integer status, Long id)</span> &#123;</span><br><span class="line">    Employee employee=Employee.builder()</span><br><span class="line">        .status(status)</span><br><span class="line">        .id(id)</span><br><span class="line">        .build();</span><br><span class="line">    employeeMapper.update(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意这里的service。因为我们想让employeeMapper.update方法更具有通用性，也就是以后想要修改别的属性也可以通过employeeMapper.update方法使用，我们就不能只传入status和id了，而是传入一个employee对象（为什么这么做有点不好理解，可以结合后面动态sql语句理解），这个employee对象中id是我们要修改的id，status是目标stauts，其余都是null。</p>
<p>接下来是mapper，这里传入了我们创建的employee对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure>

<p>一样的右键生成代码，然后在xml配置动态sql：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.sky.entity.Employee&quot;</span>&gt;</span></span><br><span class="line">    update employee</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>name = #&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span>username = #&#123;username&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span>password = #&#123;password&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;phone != null&quot;</span>&gt;</span>phone = #&#123;phone&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null&quot;</span>&gt;</span>sex = #&#123;sex&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;idNumber != null&quot;</span>&gt;</span>id_Number = #&#123;idNumber&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span>update_Time = #&#123;updateTime&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateUser != null&quot;</span>&gt;</span>update_User = #&#123;updateUser&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span>status = #&#123;status&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>解释一下这个sql：以第一个if语句为例 <code>&lt;if test=&quot;name != null&quot;&gt;name = #&#123;name&#125;,&lt;/if&gt;</code></p>
<table>
<thead>
<tr>
<th>位置</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td><code>test=&quot;name != null&quot;</code> 中的 <code>name</code></td>
<td>是传入的参数 Java 对象 <code>employee</code> 的属性：<code>employee.getName()</code></td>
</tr>
<tr>
<td><code>name = #&#123;name&#125;</code> 中的左边 <code>name</code></td>
<td>是 <strong>数据库字段名</strong>（表字段），对应 <code>employee</code> 表中的列名</td>
</tr>
<tr>
<td><code>#&#123;name&#125;</code> 中的 <code>name</code></td>
<td>是传入的参数 Java 对象 <code>employee</code> 的属性，用于参数占位符绑定</td>
</tr>
</tbody></table>
<p>假设调用如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Employee</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">emp.setId(<span class="number">1L</span>);</span><br><span class="line">emp.setName(<span class="string">&quot;张三&quot;</span>);</span><br><span class="line">employeeMapper.update(emp);</span><br></pre></td></tr></table></figure>

<p>那么：<code>name != null</code> → 会判断 <code>emp.getName() != null</code>，返回 <code>true</code>，<code>name = #&#123;name&#125;</code> → 会生成 SQL 片段：<code>name = &#39;张三&#39;</code>。而其他字段都是空，因此不会做更新。</p>
<p>最终生成的 SQL 是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> employee</span><br><span class="line"><span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;张三&#x27;</span></span><br><span class="line"><span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>至此，我们的代码开发完毕。</p>
<p>测试略，没有新东西。</p>
<h2 id="day2-12-编辑员工-需求分析与设计"><a href="#day2-12-编辑员工-需求分析与设计" class="headerlink" title="day2-12 编辑员工-需求分析与设计"></a>day2-12 编辑员工-需求分析与设计</h2><p><img src="/.io//image-20250717205204165.png"></p>
<p>需要两个接口，一个是修改前用于页面回显（查询），一个是更新。</p>
<p><img src="/.io//image-20250717205347679.png"></p>
<p><img src="/.io//image-20250717205427011.png"></p>
<h2 id="day2-13-编辑员工-代码开发"><a href="#day2-13-编辑员工-代码开发" class="headerlink" title="day2-13 编辑员工-代码开发"></a>day2-13 编辑员工-代码开发</h2><p>首先是查询，这个功能非常简单，直接上代码：</p>
<p>控制器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;根据id查询员工信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;Employee&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">    Employee employee=employeeService.getById(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service（为了安全起见，传给前端的时候把密码抹掉）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Employee <span class="title function_">getById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    Employee employee=employeeMapper.getById(id);</span><br><span class="line">    employee.setPassword(<span class="string">&quot;****&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> employee;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mapper，比较简单，直接写sql：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from employee where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">Employee <span class="title function_">getById</span><span class="params">(Long id)</span>;</span><br></pre></td></tr></table></figure>

<p>下面是编辑员工信息：</p>
<p>控制器，注意观察接口文档中的Body字段，容易看出来我们这时候应该用DTO而不是Employee本身：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;编辑员工信息&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> EmployeeDTO employeeDTO)</span>&#123;</span><br><span class="line">    employeeService.update(employeeDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service，注意把DTO转成Employee，符合update接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(EmployeeDTO employeeDTO)</span> &#123;</span><br><span class="line">    Employee employee=<span class="keyword">new</span> <span class="title class_">Employee</span>();</span><br><span class="line">    BeanUtils.copyProperties(employeeDTO,employee);</span><br><span class="line">    employee.setUpdateTime(LocalDateTime.now());</span><br><span class="line">    employee.setCreateUser(BaseContext.getCurrentId());</span><br><span class="line">    employee.setUpdateUser(BaseContext.getCurrentId());</span><br><span class="line">    employeeMapper.update(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mapper，和前面2-11一样，xml代码不再重复：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure>



<h2 id="day2-15-分类管理代码导入"><a href="#day2-15-分类管理代码导入" class="headerlink" title="day2-15 分类管理代码导入"></a>day2-15 分类管理代码导入</h2><p>由于代码和之前很类似，因此直接导入。</p>
<p>原型：</p>
<p><img src="/.io//image-20250717224100447.png"></p>
<p>分类分为两种大的类型，菜品分类和套餐分类。</p>
<p><img src="/.io//image-20250717224139888.png"></p>
<p>六个接口：新增分类，分类分页查询，根据id删除分类，修改分类，启用禁用分类，根据类型查询分类。</p>
<p><img src="/.io//image-20250717224600001.png"></p>
<p>数据库设计：</p>
<p><img src="/.io//image-20250717225158955.png"></p>
<p>代码导入：略。</p>
<p>测试：略。</p>
<h2 id="day3-1-公共字段自动填充-AOP-面向切面编程"><a href="#day3-1-公共字段自动填充-AOP-面向切面编程" class="headerlink" title="day3-1 公共字段自动填充 (AOP, 面向切面编程)"></a>day3-1 公共字段自动填充 (AOP, 面向切面编程)</h2><p><img src="/.io//image-20250717230424387.png"></p>
<p>由于表中含有公共字段，冗余代码过多，不便于后期维护。</p>
<p>创建时间会在insert赋值，修改时间会在insert和update赋值。</p>
<p>实现思路：</p>
<p><img src="/.io//image-20250717230647212.png"></p>
<p>技术点：枚举，注解，AOP，反射。</p>
<p>AOP（面向切面编程）是一种编程模式，<strong>让开发者在不修改核心代码的前提下，给程序动态添加通用功能</strong>（比如日志、权限检查、事务管理）。</p>
<p>假设你有一本小说（核心业务逻辑），现在想给每一章的开头加一句“本章由AI生成”（通用功能）。传统做法：手动修改每一章的开头 → <strong>代码重复、侵入性强</strong>。AOP做法：直接给整本书套一个“自动盖章机” → <strong>非侵入式、集中管理</strong>。</p>
<p>AOP通过 <strong>切面（Aspect）</strong> 将 <strong>横切关注点</strong> 从业务代码中分离，包含以下核心组件：</p>
<ol>
<li><strong>Join Point（连接点）</strong>：程序执行中的特定点（如方法调用、异常抛出）。</li>
<li><strong>Pointcut（切点）</strong>：匹配一组连接点的表达式（定义在哪里插入代码）。</li>
<li><strong>Advice（通知）</strong>：在连接点执行的具体逻辑（如前置、后置、环绕通知）。</li>
<li><strong>Aspect（切面）</strong>：包含切点和通知的模块化单元。</li>
</ol>
<p>AOP通过在程序执行的不同阶段织入切面代码来实现其功能。织入（weaving）是指将切面代码与目标代码合并的过程。</p>
<p>有两种主要的织入方式：编译时织入和运行时织入。</p>
<h2 id="day3-2-公共字段自动填充-代码开发-AOP-反射"><a href="#day3-2-公共字段自动填充-代码开发-AOP-反射" class="headerlink" title="day3-2 公共字段自动填充 代码开发 (AOP, 反射)"></a>day3-2 公共字段自动填充 代码开发 (AOP, 反射)</h2><p>步骤：</p>
<ul>
<li><strong>自定义注解 AutoFill</strong>：创建一个名为 <code>AutoFill</code> 的注解，用于标记那些需要自动填充公共字段的方法。</li>
<li><strong>自定义切面类 AutoFillAspect</strong>：创建一个名为 <code>AutoFillAspect</code> 的切面类。在这个切面类中，拦截所有使用了 <code>AutoFill</code> 注解的方法，并通过反射机制为这些方法中的公共字段自动赋值。</li>
<li><strong>在 Mapper 的方法上加入 AutoFill 注解</strong>：这样这些方法在执行时就会自动触发切面逻辑，完成公共字段的自动填充。</li>
</ul>
<h3 id="自定义注解"><a href="#自定义注解" class="headerlink" title="自定义注解"></a>自定义注解</h3><p>首先创建包 sky-server&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;sky&#x2F;annotation，并在包下创建注解 AutoFill：</p>
<p><img src="/.io//image-20250718084515764.png"></p>
<p>自定义注解如下（注解本质上是一个特殊的接口，编译器会帮你生成实现类）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoFill &#123;</span><br><span class="line">    <span class="comment">// 数据库操作类型</span></span><br><span class="line">    OperationType <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解释一下：@Target(ElementType.METHOD)代表表示这个注解只能用在“方法”上，如果你用在字段、类上，就会报错，例如下面就是正确使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoFill(OperationType.INSERT)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">    <span class="comment">// 插入逻辑</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Retention(RetentionPolicy.RUNTIME)代表这个注解在<strong>运行时</strong>依然存在，JVM 会保留它，程序可以通过 <strong>反射</strong> 获取到它。这条在AOP中是必须写的，因为只有运行时保留，切面才能拦截到这个注解。</p>
<p>OperationType value();是什么意思呢？这是注解的参数，表示你要传入一个值，类型是 <code>OperationType</code>（一个自定义的枚举）。</p>
<p>举个例子，如果注解参数这样写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> LogInfo &#123;</span><br><span class="line">    String <span class="title function_">action</span><span class="params">()</span>;</span><br><span class="line">    String <span class="title function_">module</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么使用应该：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@LogInfo(action = &quot;添加用户&quot;, module = &quot;用户管理&quot;)</span></span><br></pre></td></tr></table></figure>

<p>如果注解参数这样写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyTag &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>; <span class="comment">// 这就是一个“参数”</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么使用应该：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyTag(value = &quot;重要的方法&quot;)</span></span><br></pre></td></tr></table></figure>

<p>注意，这个<strong>等同于</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MyTag(&quot;重要的方法&quot;)</span></span><br></pre></td></tr></table></figure>

<p>因此，如果我们注解参数是 <code>OperationType value();</code> 的话，可以直接写：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoFill(OperationType.INSERT)</span></span><br></pre></td></tr></table></figure>

<p>这里 <code>value()</code> 就会等于 <code>OperationType.INSERT</code>。</p>
<h3 id="自定义切面类"><a href="#自定义切面类" class="headerlink" title="自定义切面类"></a>自定义切面类</h3><p>创建包sky-server&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;sky&#x2F;aspect，创建切面类AutoFillAspect：</p>
<p><strong>切面&#x3D;通知+切入点</strong>，即要“切”的地方（即：拦截哪些方法）+要“切”进去干的事（具体要做什么）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoFillAspect</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 切入点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.annotation.AutoFill)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFillPointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;autoFillPointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFill</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();</span><br><span class="line">        AutoFill autoFill=signature.getMethod().getAnnotation(AutoFill.class);</span><br><span class="line">        OperationType operationType=autoFill.value();</span><br><span class="line"></span><br><span class="line">        Object[] args=joinPoint.getArgs();</span><br><span class="line">        <span class="keyword">if</span>(args==<span class="literal">null</span> || args.length==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Object entity=args[<span class="number">0</span>];</span><br><span class="line">        LocalDateTime now=LocalDateTime.now();</span><br><span class="line">        Long currentId= BaseContext.getCurrentId();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(operationType==OperationType.INSERT)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Method setCreateTime=entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_TIME,LocalDateTime.class);</span><br><span class="line">                Method setCreateUser=entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_USER,Long.class);</span><br><span class="line">                Method setUpdateTime=entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME,LocalDateTime.class);</span><br><span class="line">                Method setUpdateUser=entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER,Long.class);</span><br><span class="line"></span><br><span class="line">                setCreateTime.invoke(entity, now);</span><br><span class="line">                setCreateUser.invoke(entity, currentId);</span><br><span class="line">                setUpdateTime.invoke(entity, now);</span><br><span class="line">                setUpdateUser.invoke(entity, currentId);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (operationType==OperationType.UPDATE) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Method setUpdateTime=entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME,LocalDateTime.class);</span><br><span class="line">                Method setUpdateUser=entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER,Long.class);</span><br><span class="line"></span><br><span class="line">                setUpdateTime.invoke(entity, now);</span><br><span class="line">                setUpdateUser.invoke(entity, currentId);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>让我们解释一下上面的代码：</p>
<h4 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoFillAspect</span></span><br></pre></td></tr></table></figure>

<p>@Aspect声明这是一个切面类，@Component将该类注册为Bean，由 Spring 管理这个类。@Slf4j之前解释过（Lombok），略。</p>
<h4 id="切入点"><a href="#切入点" class="headerlink" title="切入点"></a>切入点</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(* com.sky.mapper.*.*(..)) &amp;&amp; @annotation(com.sky.annotation.AutoFill)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFillPointCut</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<p><code>@Pointcut</code> 注解定义了<strong>要拦截的方法范围</strong>：<code>execution(* com.sky.mapper.*.*(..))</code>，匹配 <code>com.sky.mapper</code> 包下的 <strong>任意类</strong> 的 <strong>任意方法</strong>，方法参数不限。</p>
<p><code>&amp;&amp; @annotation(com.sky.annotation.AutoFill)</code>，只匹配那些被 <code>@AutoFill</code> 注解标注的方法。</p>
<p><strong>注意：切入点函数可以随意命名，<code>@Before</code> 的 value 必须和切入点函数名一样，切入点函数里面不可以写代码。</strong></p>
<h4 id="通知"><a href="#通知" class="headerlink" title="通知"></a>通知</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;autoFillPointCut()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoFill</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@Before</code> 是一个通知（Advice），表示：在目标方法执行前，先执行 autoFill() 方法。</p>
<p>当你调用 <code>employeeMapper.insert(...)</code>，如果这个方法有 <code>@AutoFill</code> 注解，就会先自动执行 <code>autoFill()</code> 方法。</p>
<p>这里的参数 <code>JoinPoint</code> 是 Spring AOP 提供的一个对象，表示<strong>当前连接点（方法）</strong>的信息。你可以通过它拿到：方法参数，注解内容等等。</p>
<p>举个例子，如果我们mapper有：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoFill(OperationType.INSERT)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure>

<p>在service层有如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">employeeMapper.insert(emp);</span><br></pre></td></tr></table></figure>

<p>那么，<code>insert()</code> 就是一个<strong>连接点</strong>。</p>
<h4 id="业务实现与反射"><a href="#业务实现与反射" class="headerlink" title="业务实现与反射"></a>业务实现与反射</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) joinPoint.getSignature();</span><br><span class="line">AutoFill autoFill=signature.getMethod().getAnnotation(AutoFill.class);</span><br><span class="line">OperationType operationType=autoFill.value();</span><br></pre></td></tr></table></figure>

<p>第一步获取方法的<strong>签名对象</strong>：获取方法签名对象的作用，是为了<strong>在 AOP 通知中拿到目标方法的详细信息</strong>，尤其是方法上的注解、方法名、参数类型等。这里我们用来获得注解的value。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Object[] args = joinPoint.getArgs();</span><br></pre></td></tr></table></figure>

<p>这句话获取目标方法在运行时接收到的实参数组，得到一个 <code>Object[]</code>，里面就是实际调用 <code>insert()</code> 时传进来的那些参数对象。（这里约定第一个参数为需要修改的对象）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Object[] args=joinPoint.getArgs();</span><br><span class="line">Object entity=args[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">Method setUpdateTime=entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_TIME,</span><br><span class="line">                                                         LocalDateTime.class);</span><br><span class="line">Method setUpdateUser=entity.getClass().getDeclaredMethod(AutoFillConstant.SET_UPDATE_USER,</span><br><span class="line">                                                         Long.class);</span><br><span class="line">setUpdateTime.invoke(entity, now);</span><br><span class="line">setUpdateUser.invoke(entity, currentId);</span><br></pre></td></tr></table></figure>

<p>上面的代码是典型的Java<strong>反射机制</strong>，动态调用对象的方法。</p>
<p>首先通过反射获取方法对象：</p>
<p><code>entity.getClass()</code>：获取传入实体对象的运行时类，比如 <code>Employee.class</code></p>
<p><code>.getDeclaredMethod(...)</code>：通过方法名和参数类型来<strong>获取这个类中的指定方法对象（<code>Method</code>）</strong></p>
<p>然后调用方法（反射执行）：</p>
<p><code>setUpdateTime.invoke(entity, now);</code> 第一个参数：调用方法的对象；后面的参数：是方法调用时传入的实际参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setUpdateUser.invoke(entity, currentId);</span><br></pre></td></tr></table></figure>

<p>等价于：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">entity.setUpdateUser(currentId);</span><br></pre></td></tr></table></figure>

<p>为什么需要反射：在 AOP 的 <code>@Before</code> 通知中，我们拿到的是 <code>Object entity</code>，<strong>它是一个未知类型的对象</strong>，为了让这个 AOP 能适配多个实体类（如 Employee、Dish、Category），就不能写死调用。反射在运行时 <code>getClass()</code> 才得知要运行的类。</p>
<p>通过反射调用方法的一般步骤：</p>
<ol>
<li>获取类的 Class 对象实例：<code>Class clz = entity.getClass();</code></li>
<li>获取方法的 Method 对象：<code>Method setPriceMethod = clz.getMethod(&quot;setPrice&quot;, int.class);</code></li>
<li>使用 invoke 调用方法：<code>setPriceMethod.invoke(appleObj, 14);</code></li>
</ol>
<p><em>注意，凡是涉及硬编码（指在程序中直接将具体的值，如字符串，数字，写死在代码中）的地方，都通过配置文件，常量类，枚举类，实现软编码。</em></p>
<p>如这里：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Method setCreateUser=entity.getClass().getDeclaredMethod(AutoFillConstant.SET_CREATE_USER,Long.class);</span><br></pre></td></tr></table></figure>

<p>这里的<code>AutoFillConstant.SET_CREATE_USER</code>就用常量类代表这个方法的字符串：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoFillConstant</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 实体类中的方法名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SET_CREATE_TIME</span> <span class="operator">=</span> <span class="string">&quot;setCreateTime&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SET_UPDATE_TIME</span> <span class="operator">=</span> <span class="string">&quot;setUpdateTime&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SET_CREATE_USER</span> <span class="operator">=</span> <span class="string">&quot;setCreateUser&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SET_UPDATE_USER</span> <span class="operator">=</span> <span class="string">&quot;setUpdateUser&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="加上自定义注解"><a href="#加上自定义注解" class="headerlink" title="加上自定义注解"></a>加上自定义注解</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Insert(&quot;INSERT INTO employee(name, username, password, phone, sex, id_number, create_time, update_time, create_user, update_user) &quot; +</span></span><br><span class="line"><span class="meta">        &quot;VALUES(#&#123;name&#125;, #&#123;username&#125;, #&#123;password&#125;, #&#123;phone&#125;, #&#123;sex&#125;, #&#123;idNumber&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;, #&#123;createUser&#125;, #&#123;updateUser&#125;)&quot;)</span></span><br><span class="line"><span class="meta">@AutoFill(OperationType.INSERT)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoFill(value = OperationType.UPDATE)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Employee employee)</span>;</span><br></pre></td></tr></table></figure>

<p>这里我们带和不带<code>value=</code>都可以。</p>
<h3 id="把原先service类中手动赋值代码删除"><a href="#把原先service类中手动赋值代码删除" class="headerlink" title="把原先service类中手动赋值代码删除"></a>把原先service类中手动赋值代码删除</h3><p>略。</p>
<h2 id="day3-5-新增菜品-需求分析"><a href="#day3-5-新增菜品-需求分析" class="headerlink" title="day3-5 新增菜品-需求分析"></a>day3-5 新增菜品-需求分析</h2><p><img src="/.io//image-20250718103447923.png"></p>
<p>要求：菜名唯一，菜品必须属于某个分类，口味不必须，图片必须。</p>
<p>菜品分类栏需要实现菜品查询，该接口已经实现过了，不需要再实现。</p>
<p>现在只需要实现文件上传和菜品新增两个接口。</p>
<p><img src="/.io//image-20250718104609212.png"></p>
<p>注意，这里返回的data是必须的，需要把图片的服务器端路径返回。</p>
<p><img src="/.io//image-20250718104858480.png"></p>
<p>数据库设计如下：</p>
<p><img src="/.io//image-20250718105500281.png"></p>
<p>逻辑外键：数据库没有创建外键，我们在java代码中自行处理。</p>
<p>菜品和口味是<strong>一对多的关系</strong>，因此在口味中设置菜品的主键。一个菜品有多种口味，应该在一个菜品中选择不同的口味，比如你在点菜时候想点一条鱼，我可以选择辣或者不辣；但是先选择辣或不辣再选菜品是没有意义的。</p>
<h2 id="day3-6-新增菜品-代码开发-对象存储服务OSS-读取yml配置文件到java代码"><a href="#day3-6-新增菜品-代码开发-对象存储服务OSS-读取yml配置文件到java代码" class="headerlink" title="day3-6 新增菜品-代码开发 (对象存储服务OSS, 读取yml配置文件到java代码)"></a>day3-6 新增菜品-代码开发 (对象存储服务OSS, 读取yml配置文件到java代码)</h2><p>阿里云的对象存储服务 OSS（<strong>Object Storage Service</strong>），是一种<strong>云端文件存储服务</strong>，可以让你把任意格式的数据（如图片、视频、文档、日志、备份文件等）<strong>存储在云端，并随时随地访问、下载或共享</strong>。</p>
<p><strong>Bucket（存储空间）</strong>类似于文件夹，用来组织和隔离你的文件资源。每个 Bucket 的名称是唯一的。</p>
<p><strong>Object（对象）</strong>就是你存储的文件，比如图片、视频、压缩包。每个 Object 有一个唯一的 Key（路径名）。</p>
<p><strong>Endpoint（访问域名）</strong>：用来访问你存储资源的地址。</p>
<p><strong>AccessKey ID &#x2F; Secret</strong>：访问 OSS 所需的身份凭证，用于身份认证。</p>
<p>在使用阿里云OSS之前，需要在application.yml进行配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">alioss:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">$&#123;sky.alioss.endpoint&#125;</span></span><br><span class="line">    <span class="attr">access-key-id:</span> <span class="string">$&#123;sky.alioss.access-key-id&#125;</span></span><br><span class="line">    <span class="attr">access-key-secret:</span> <span class="string">$&#123;sky.alioss.access-key-secret&#125;</span></span><br><span class="line">    <span class="attr">bucket-name:</span> <span class="string">$&#123;sky.alioss.bucket-name&#125;</span></span><br></pre></td></tr></table></figure>

<p>为什么要使用引用方式配置？</p>
<p>我们的项目会经历开发阶段、测试阶段和生产阶段，不同阶段对应的服务器（如数据库、OSS、Redis 等）配置往往不同。</p>
<p>因此，我们会将通用配置放在主配置文件 <code>application.yml</code> 中，而将环境相关的配置分别放在 <code>application-dev.yml</code>、<code>application-test.yml</code> 和 <code>application-prod.yml</code> 文件中。</p>
<p>Spring Boot 会通过设置 <code>spring.profiles.active</code> 属性来决定当前使用哪一个环境配置文件。</p>
<p>例如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">main:</span></span><br><span class="line">    <span class="attr">allow-circular-references:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">driver-class-name:</span> <span class="string">$&#123;sky.datasource.driver-class-name&#125;</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">jdbc:mysql://$&#123;sky.datasource.host&#125;:$&#123;sky.datasource.port&#125;/$&#123;sky.datasource.database&#125;?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">$&#123;sky.datasource.username&#125;</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">$&#123;sky.datasource.password&#125;</span></span><br></pre></td></tr></table></figure>

<p>在这里，active的就是dev，也就是application-dev.yml是我们当前有效的配置文件。下面的sql配置也是使用引用方式，具体值写在dev配置文件中：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">3030</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">sky_take_out</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">****</span></span><br></pre></td></tr></table></figure>

<p>因此我们主配置文件使用引用方式，而不是写死，具体配置的值在dev，test，prod等配置文件中写，根据开发阶段，测试阶段，生产阶段的不同，主配置文件上面会写当前有效的是哪个配置文件。</p>
<p>让我们回到阿里云OSS配置。（这里需要我们在阿里云申请一个OSS，申请过程略）完善application-dev.yml：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5005</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">sky_take_out</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">  <span class="attr">alioss:</span></span><br><span class="line">    <span class="attr">endpoint:</span> <span class="string">oss-cn-beijing.aliyuncs.com</span></span><br><span class="line">    <span class="attr">bucket-name:</span> <span class="string">***</span></span><br><span class="line">    <span class="attr">access-key-secret:</span> <span class="string">***</span></span><br><span class="line">    <span class="attr">access-key-id:</span> <span class="string">***</span></span><br></pre></td></tr></table></figure>

<p>该项目已经开发好了一个用于OSS上传文件的工具类：sky-common&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;sky&#x2F;utils&#x2F;AliOssUtil.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOssUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;</span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;</span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="type">byte</span>[] bytes, String objectName)</span> &#123;</span><br><span class="line">		<span class="comment">//上传逻辑</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个类的字段没有被初始化，我们拿不到这些字段值无法进行上传。我们现在的任务就是从配置文件中读取配置，然后把配置赋值给这里的字段。怎么做呢？</p>
<p>在 <strong>Spring Boot 项目中，我们可以非常优雅地将 <code>application.yml</code> 中的配置读取到 Java 代码中使用</strong>。</p>
<p>方法就是通过<strong>创建一个配置属性类</strong>，我们使用 <code>@ConfigurationProperties</code> 注解来绑定配置，<code>@Component</code> 或 <code>@Configuration</code> 让它成为 Spring Bean。<code>@ConfigurationProperties(prefix = &quot;aliyun.oss&quot;)</code> 指的是你要读取的配置路径。使用 <code>@Data</code>（Lombok）自动生成 getter&#x2F;setter。</p>
<p>在我们的项目中，我们创建了一个配置属性类sky-common&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;sky&#x2F;properties&#x2F;AliOssProperties.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;sky.alioss&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AliOssProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String endpoint;</span><br><span class="line">    <span class="keyword">private</span> String accessKeyId;</span><br><span class="line">    <span class="keyword">private</span> String accessKeySecret;</span><br><span class="line">    <span class="keyword">private</span> String bucketName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来再创建一个配置类sky-server&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;sky&#x2F;config&#x2F;OssConfiguration.java。</p>
<p>这个类基于AliOssProperties创建一个 OSS 工具类 AliOssUtil，并将其注册为 Spring 的 Bean，在项目中全局可用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OssConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="keyword">public</span> AliOssUtil <span class="title function_">aliOssUtil</span><span class="params">(AliOssProperties aliOssProperties)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AliOssUtil</span>(aliOssProperties.getEndpoint(),</span><br><span class="line">                aliOssProperties.getAccessKeyId(),</span><br><span class="line">                aliOssProperties.getAccessKeySecret(),</span><br><span class="line">                aliOssProperties.getBucketName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里 <code>@Bean</code> 将 <code>aliOssUtil(...)</code> 方法返回的对象注入到 Spring 容器中，这样这个方法就自动被执行，把这个AliOssProperties对象创建出来并交给 Spring 管理。@ConditionalOnMissingBean保证只创建一次。</p>
<p>综上，理一遍过程。</p>
<p>先在阿里云OSS进行申请；</p>
<p>然后在application.yml配置阿里云OSS，注意使用引用方式；然后在application-dev.yml配置具体的值；</p>
<p>实现用于OSS上传文件的工具类AliOssUtil，注意使用全部参数构造方法注解@AllArgsConstructor，便于后面对象创建；</p>
<p>接下来创建AliOssProperties类，使用 <code>@ConfigurationProperties</code> 注解来绑定配置，自动将 <code>application.yml</code> 中的配置项绑定到 Java 对象里，方便后续直接用对象访问配置值；</p>
<p>然后创建OssConfiguration类，基于AliOssProperties创建一个 OSS 工具类 AliOssUtil，并将其注册为 Spring 的 Bean，在项目中全局可用。</p>
<h2 id="day3-7-新增菜品-图片上传控制器-UUID"><a href="#day3-7-新增菜品-图片上传控制器-UUID" class="headerlink" title="day3-7 新增菜品-图片上传控制器 (UUID)"></a>day3-7 新增菜品-图片上传控制器 (UUID)</h2><p>编写控制器代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/common&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;通用接口&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AliOssUtil aliOssUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;文件上传&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;String&gt; <span class="title function_">upload</span><span class="params">(MultipartFile file)</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String originalFilename=file.getOriginalFilename();</span><br><span class="line">            String extension=originalFilename.substring(originalFilename.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">            String objectName=UUID.randomUUID().toString() + extension;</span><br><span class="line">            String filePath=aliOssUtil.upload(file.getBytes(), objectName);</span><br><span class="line">            <span class="keyword">return</span> Result.success(filePath);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(String.valueOf(e));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.error(MessageConstant.UPLOAD_FAILED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自动注入我们前面的工具类AliOssUtil并调用方法。注意这里使用UUID生成唯一的文件名，避免被覆盖。</p>
<h2 id="day3-8-新增菜品-代码开发-多表插入-事务注解-主键回填"><a href="#day3-8-新增菜品-代码开发-多表插入-事务注解-主键回填" class="headerlink" title="day3-8 新增菜品-代码开发 (多表插入, 事务注解, 主键回填)"></a>day3-8 新增菜品-代码开发 (多表插入, 事务注解, 主键回填)</h2><p>回顾一下现在需要开发的接口的文档：</p>
<p><img src="/.io//image-20250718193835116.png"></p>
<p>我们可以把这个Body封装为DTO：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//菜品名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//菜品分类id</span></span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="comment">//菜品价格</span></span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="comment">//图片</span></span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="comment">//描述信息</span></span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="comment">//0 停售 1 起售</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="comment">//口味</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;DishFlavor&gt; flavors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中DishFlavor是口味实体类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishFlavor</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">1L</span>;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="comment">//菜品id</span></span><br><span class="line">    <span class="keyword">private</span> Long dishId;</span><br><span class="line">    <span class="comment">//口味名称</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">//口味值</span></span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来写控制器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/dish&quot;)</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;菜品接口&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishService dishService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;新增菜品&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span>&#123;</span><br><span class="line">        dishService.saveWithFlavor(dishDTO);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">DishService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishMapper dishMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DishFlavorMapper dishFlavorMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveWithFlavor</span><span class="params">(DishDTO dishDTO)</span> &#123;</span><br><span class="line">        Dish dish=<span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">        BeanUtils.copyProperties(dishDTO,dish);</span><br><span class="line">        dishMapper.insert(dish);</span><br><span class="line">        Long dishId=dish.getId();</span><br><span class="line">        List&lt;DishFlavor&gt; flavors=dishDTO.getFlavors();</span><br><span class="line">        <span class="keyword">if</span>(flavors!=<span class="literal">null</span> &amp;&amp; flavors.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            flavors.forEach(dishFlavor -&gt; &#123;</span><br><span class="line">                dishFlavor.setDishId(dishId);</span><br><span class="line">            &#125;);</span><br><span class="line">            dishFlavorMapper.insertBatch(flavors);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意这里<code>@Transactional</code> 是 Spring 框架中用于 <strong>声明式事务管理</strong> 的注解，确保一组数据库操作要么全部成功，要么全部失败（回滚）。</p>
<p>@Transactional要用在 Service 层而不要用在其他层。</p>
<p>@Transactional要使用需要在启动类开启注解方式的事务管理。</p>
<p>启动类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span> <span class="comment">//开启注解方式的事务管理</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SkyApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SkyApplication.class, args);</span><br><span class="line">        log.info(<span class="string">&quot;server started&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>回到service代码，解释一下这里的业务逻辑：由于我们添加菜品的时候需要对两个表进行操作，一个是菜品表（Dish）一个是口味表（DishFlavor），因此需要调用两个不同的mapper。</p>
<p>在添加菜品（Dish）的时候，由于数据库中存的是菜品，因此要把DTO转成实体，用BeanUtils.copyProperties属性拷贝即可，创建一个新的Dish对象，再把它插入数据库，很简单。</p>
<p>问题在于口味表（DishFlavor），口味表中有一个字段叫做dish_id，也就是菜品的ID，但是前端传来的DTO中是不包含dish_id的（dish_id是dish插入数据库后，数据库自己生成的），这样我们需要把这个主键值回传回java代码中。</p>
<p>要实现这个需求，我们先看看DishMapper.xml是怎么写的：</p>
<p>DishMapper：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoFill(OperationType.INSERT)</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Dish dish)</span>;</span><br></pre></td></tr></table></figure>

<p>DishMapper.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.DishMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.sky.entity.Dish&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">        insert into dish(name, category_id, price, image, description, create_time, update_time, create_user, update_user, status)</span><br><span class="line">        values</span><br><span class="line">            (</span><br><span class="line">                #&#123;name&#125;,</span><br><span class="line">                #&#123;categoryId&#125;,</span><br><span class="line">                #&#123;price&#125;,</span><br><span class="line">                #&#123;image&#125;,</span><br><span class="line">                #&#123;description&#125;,</span><br><span class="line">                #&#123;createTime&#125;,</span><br><span class="line">                #&#123;updateTime&#125;,</span><br><span class="line">                #&#123;createUser&#125;,</span><br><span class="line">                #&#123;updateUser&#125;,</span><br><span class="line">                #&#123;status&#125;</span><br><span class="line">            )</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>重点在于useGeneratedKeys&#x3D;”true”以及keyProperty&#x3D;”id”。前者表示：获取数据库生成的主键（如自增主键），然后将这个主键值<strong>回填到 Java 对象中</strong>，后者表示：<strong>MyBatis 会把数据库生成的主键值，赋值给 Java 对象中的哪个属性</strong>。这里是 <code>id</code>，表示主键值将回填到 <code>Dish</code> 对象的 <code>id</code> 字段。</p>
<p>这样让我们再看service代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dishMapper.insert(dish);</span><br><span class="line">Long dishId=dish.getId();</span><br></pre></td></tr></table></figure>

<p>前面调用insert，mapper通过回填把dish的id回填到java对象dish中，后面就可以直接调用getter把id取出来。</p>
<p>取出来之后，通过setter赋值，给口味赋值dishId。</p>
<p>最后调用dishFlavorMapper.insertBatch()方法把口味存到数据库。</p>
<p>DishFlavorMapper.xml如下（mapper接口就一句话，这里不单列出了）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.sky.mapper.DishFlavorMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span>&gt;</span></span><br><span class="line">        insert into dish_flavor (dish_id, name, value) VALUES</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;flavors&quot;</span> <span class="attr">item</span>=<span class="string">&quot;df&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (#&#123;df.dishId&#125;, #&#123;df.name&#125;, #&#123;df.value&#125;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里使用了foreach，解释一下：</p>
<p><code>collection=&quot;flavors&quot;</code>：表示要遍历的集合（参数中传入的 List 或数组）；</p>
<p><code>item=&quot;df&quot;</code>：每次遍历出来的单个元素，变量名为 <code>df</code>；</p>
<p><code>separator=&quot;,&quot;</code>：<strong>每个项之间用英文逗号 <code>,</code> 连接</strong>，生成合法的 <code>VALUES</code> 语句；</p>
<p><code>#&#123;df.xxx&#125;</code>：就是取出这个对象的字段值。</p>
<p>其他都好理解，因为我们传入了一个List，但separator&#x3D;”,”是什么意思？</p>
<p>设置 <code>separator=&quot;,&quot;</code> 是为了构造合法的 SQL 语句，确保多个 <code>VALUES</code> 子句之间用逗号分隔：</p>
<p>如果你希望执行的是如下格式的 SQL：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert into</span> dish_flavor (dish_id, name, <span class="keyword">value</span>) <span class="keyword">VALUES</span></span><br><span class="line">  (<span class="number">1</span>, <span class="string">&#x27;辣&#x27;</span>, <span class="string">&#x27;微辣&#x27;</span>),</span><br><span class="line">  (<span class="number">1</span>, <span class="string">&#x27;甜&#x27;</span>, <span class="string">&#x27;中甜&#x27;</span>),</span><br><span class="line">  (<span class="number">1</span>, <span class="string">&#x27;麻&#x27;</span>, <span class="string">&#x27;中麻&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>可以看到多个 <code>(值, 值, 值)</code> 之间是用英文逗号 <code>,</code> 分隔的，separator&#x3D;”,”正是让每次循环之间用逗号隔开，符合 SQL 写法。</p>
<p>现在新增菜品的业务代码已经全部实现了。</p>
<h2 id="day3-10-菜品分页查询-需求分析"><a href="#day3-10-菜品分页查询-需求分析" class="headerlink" title="day3-10 菜品分页查询-需求分析"></a>day3-10 菜品分页查询-需求分析</h2><p><img src="/.io//image-20250718200958632.png"></p>
<p>注意！！！返回数据中有一个叫做categoryName，但是我们菜品表中只有分类的ID，并没有存名称！</p>
<h2 id="day3-11-菜品分页查询-代码开发-多表查询-外连接"><a href="#day3-11-菜品分页查询-代码开发-多表查询-外连接" class="headerlink" title="day3-11 菜品分页查询-代码开发 (多表查询, 外连接)"></a>day3-11 菜品分页查询-代码开发 (多表查询, 外连接)</h2><p>首先根据query字段封装DTO：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishPageQueryDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> page;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> pageSize;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer categoryId;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后根据返回数据设计VO（因为要返回给前端的数据和目前的类都不匹配，也即categoryName属性在菜品表中并不存在，因此创建一个VO，VO字段和返回数据字段匹配）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;DishFlavor&gt; flavors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/page&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;菜品分页查询&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;PageResult&gt; <span class="title function_">page</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span>&#123;</span><br><span class="line">    PageResult pageResult=dishService.pageQuery(dishPageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success(pageResult);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>复习一下PageResult：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageResult</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> total; <span class="comment">//总记录数</span></span><br><span class="line">    <span class="keyword">private</span> List records; <span class="comment">//当前页数据集合</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以看到有total和records，完美符合接口文档返回数据的设计，同时records中存的VO和接口文档返回数据也一致。</p>
<p>service，其实就是分页查询的模板了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> PageResult <span class="title function_">pageQuery</span><span class="params">(DishPageQueryDTO dishPageQueryDTO)</span> &#123;</span><br><span class="line">    PageHelper.startPage(dishPageQueryDTO.getPage(),dishPageQueryDTO.getPageSize());</span><br><span class="line">    Page&lt;DishVO&gt; page=dishMapper.pageQuery(dishPageQueryDTO);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">PageResult</span>(page.getTotal(),page.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来要实现mapper，写mapper之前，我们可以先在查询终端写sql看看能不能查询出来：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> d.<span class="operator">*</span>,c.name <span class="keyword">as</span> categoryName <span class="keyword">from</span> dish d <span class="keyword">left</span> <span class="keyword">outer</span> <span class="keyword">join</span> category c <span class="keyword">on</span> d.category_id <span class="operator">=</span> c.id</span><br></pre></td></tr></table></figure>

<p>上面的sql语句可以正常执行。注意这里必须改别名为categoryName，不然mybatis无法进行封装。</p>
<p>下面我们来写mapper.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;pageQuery&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.sky.vo.DishVO&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.sky.dto.DishPageQueryDTO&quot;</span>&gt;</span></span><br><span class="line">    select d.*,c.name as categoryName from dish d left outer join category c on d.category_id = c.id</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name!=null&quot;</span>&gt;</span></span><br><span class="line">            and d.name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId!=null&quot;</span>&gt;</span></span><br><span class="line">            and d.category_id = #&#123;categoryId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status!=null&quot;</span>&gt;</span></span><br><span class="line">            and d.status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by d.create_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>解释一下，<code>Page&lt;DishVO&gt; page=dishMapper.pageQuery(dishPageQueryDTO);</code>这句话意味着，mapper传入参数是DTO，返回值是VO。</p>
<p>这里传入的DTO其实就是查询的条件。如果DTO是空的就没查询条件；如果DTO只有status意味着只需要进行状态筛选。这个逻辑对应着mapper.xml中的3个if语句，例如<code>&lt;if test=&quot;categoryId!=null&quot;&gt;and d.category_id = #&#123;categoryId&#125;&lt;/if&gt;</code>这句话，categoryId就是DTO的字段，category_id是数据库表字段。</p>
<p>至此代码编写完毕。</p>
<h2 id="day3-12-删除菜品-需求分析"><a href="#day3-12-删除菜品-需求分析" class="headerlink" title="day3-12 删除菜品-需求分析"></a>day3-12 删除菜品-需求分析</h2><p><img src="/.io//image-20250719101903388.png"></p>
<p>可以一次删除一个，也可以批量删除。起售中的菜品不能删除。被套餐关联的不能删除。被套餐关联的菜品不能删除。删除菜品后把口味也删除。</p>
<p><img src="/.io//image-20250719102305412.png"></p>
<p><img src="/.io//image-20250719102344495.png"></p>
<h2 id="day3-13-删除菜品-代码开发-RequestParam-PathVariable-RestControllerAdvice"><a href="#day3-13-删除菜品-代码开发-RequestParam-PathVariable-RestControllerAdvice" class="headerlink" title="day3-13 删除菜品-代码开发 (@RequestParam, @PathVariable, @RestControllerAdvice)"></a>day3-13 删除菜品-代码开发 (@RequestParam, @PathVariable, @RestControllerAdvice)</h2><p>控制器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;菜品批量删除&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">    dishService.deleteBatch(ids);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当 Spring 看到 <code>@RequestParam List&lt;Long&gt; ids</code> 时，会自动将 <code>ids</code> 里的字符串 <code>1,2,3</code> 转换为 <code>List&lt;Long&gt;</code>，即每个逗号分隔的数字会变成 <code>Long</code> 类型并放入 List 中。</p>
<p>注意区别<code>@RequestParam</code>和之前的<code>@PathVariable</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/status/&#123;status&#125;&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;启用禁用员工账号&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">startOrStop</span><span class="params">(<span class="meta">@PathVariable</span> Integer status, Long id)</span>&#123;</span><br><span class="line">    employeeService.startOrStop(status, id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>对比项</th>
<th><code>@PathVariable</code></th>
<th><code>@RequestParam</code></th>
</tr>
</thead>
<tbody><tr>
<td>来源</td>
<td>路径参数 <code>/user/&#123;id&#125;</code></td>
<td>查询参数 <code>?id=123</code></td>
</tr>
<tr>
<td>示例路径</td>
<td><code>/user/123</code></td>
<td><code>/user?id=123</code></td>
</tr>
</tbody></table>
<p>service：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBatch</span><span class="params">(List&lt;Long&gt; ids)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">        Dish dish=dishMapper.getByID(id);</span><br><span class="line">        <span class="keyword">if</span> (dish.getStatus().equals(StatusConstant.ENABLE))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_ON_SALE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;Long&gt; setmealIds=setmealDishMapper.getSetmealIdsByDishIds(ids);</span><br><span class="line">    <span class="keyword">if</span>(setmealIds!=<span class="literal">null</span> &amp;&amp; setmealIds.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">DeletionNotAllowedException</span>(MessageConstant.DISH_BE_RELATED_BY_SETMEAL);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (Long id : ids) &#123;</span><br><span class="line">        dishMapper.deleteById(id);</span><br><span class="line">        dishFlavorMapper.deleteByDishId(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们在写这个代码的时候有一个问题，为什么在service中throw了异常，且controller中没有try-catch却没有报错？</p>
<p>答案是我们用了全局异常捕获类sky-server&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;sky&#x2F;handler&#x2F;GlobalExceptionHandler.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">exceptionHandler</span><span class="params">(BaseException ex)</span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;异常信息：&#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">        <span class="keyword">return</span> Result.error(ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">exceptionHandler</span><span class="params">(SQLIntegrityConstraintViolationException ex)</span>&#123;</span><br><span class="line">        String msg=ex.getMessage();</span><br><span class="line">        log.error(<span class="string">&quot;异常信息：&#123;&#125;&quot;</span>, ex.getMessage());</span><br><span class="line">        <span class="keyword">if</span>(msg.contains(<span class="string">&quot;Duplicate entry&quot;</span>))&#123;</span><br><span class="line">            String[] tmp=msg.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">            String username=tmp[<span class="number">2</span>];</span><br><span class="line">            String errMsg=username+<span class="string">&quot; 已存在&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> Result.error(errMsg);</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Result.error(MessageConstant.UNKNOWN_ERROR);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中这里BaseException <em>extends</em> RuntimeException，而我们的自定义异常类都继承BaseException。</p>
<p>BaseException也是我们自定义的，sky-common&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;sky&#x2F;exception&#x2F;BaseException.java。这样写就可以把所有自定义的运行时异常全部全局捕获。</p>
<p>如果你没有在 Controller 中显式地捕获异常，Spring 可以通过 <code>@RestControllerAdvice</code> 来集中处理所有控制器中的异常。<code>@RestControllerAdvice</code> 可以作为全局异常处理器，捕获控制器中抛出的异常，并返回统一的错误响应。</p>
<p>继续写mapper（套餐）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getSetmealIdsByDishIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span></span><br><span class="line">    select setmeal_id from setmeal_dish where dish_id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;dishIds&quot;</span> <span class="attr">item</span>=<span class="string">&quot;dishId&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;dishId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>解释一下这个动态sql：</p>
<p>这段sql最终等效的sql应该是：<code>select setmeal_id from setmeal_dish where dish_id in (1,2,3)</code></p>
<p>注意后面的(1,2,3)，这里我们需要加括号（使用open和close），同时每个dishId用逗号分隔（separator）。</p>
<p>其余的deleteById等mapper接口，太简单，直接注解sql语句即可，这里略。 </p>
<h2 id="修改菜品day3-15-修改菜品-需求分析"><a href="#修改菜品day3-15-修改菜品-需求分析" class="headerlink" title="修改菜品day3-15 修改菜品-需求分析"></a>修改菜品day3-15 修改菜品-需求分析</h2><p><img src="/.io//image-20250719112804167.png"></p>
<p>复杂点主要在回显，修改很简单。</p>
<p><img src="/.io//image-20250719112937642.png"></p>
<p><img src="/.io//image-20250719113043593.png"></p>
<h2 id="day3-16-修改菜品-查询接口开发"><a href="#day3-16-修改菜品-查询接口开发" class="headerlink" title="day3-16 修改菜品-查询接口开发"></a>day3-16 修改菜品-查询接口开发</h2><p>查询采用路径参数<code>/&#123;id&#125;</code>，别忘了@PathVariable。</p>
<p>返回值由于和实体类差别较大，因此封装为VO对象，VO对象和返回值字段一一对应：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DishVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Long categoryId;</span><br><span class="line">    <span class="keyword">private</span> BigDecimal price;</span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">    <span class="keyword">private</span> String categoryName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;DishFlavor&gt; flavors = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很简单，建议不看。</p>
<p>controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;根据id查询菜品&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;DishVO&gt; <span class="title function_">getById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span>&#123;</span><br><span class="line">    DishVO dishVO=dishService.getByIdWithFlavor(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success(dishVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> DishVO <span class="title function_">getByIdWithFlavor</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    Dish dish=dishMapper.getByID(id);</span><br><span class="line">    List&lt;DishFlavor&gt; dishFlavors=dishFlavorMapper.getByDishId(id);</span><br><span class="line">    DishVO dishVO=<span class="keyword">new</span> <span class="title class_">DishVO</span>();</span><br><span class="line">    BeanUtils.copyProperties(dish, dishVO);</span><br><span class="line">    dishVO.setFlavors(dishFlavors);</span><br><span class="line">    <span class="keyword">return</span> dishVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>mapper：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from dish where id = #&#123;id&#125;&quot;)</span></span><br><span class="line">Dish <span class="title function_">getByID</span><span class="params">(Long id)</span>;</span><br><span class="line"><span class="meta">@Select(&quot;select * from dish_flavor where dish_id = #&#123;dishId&#125;&quot;)</span></span><br><span class="line">List&lt;DishFlavor&gt; <span class="title function_">getByDishId</span><span class="params">(Long dishId)</span>;</span><br></pre></td></tr></table></figure>

<p>开发完毕。</p>
<h2 id="day3-17-修改菜品-修改接口开发"><a href="#day3-17-修改菜品-修改接口开发" class="headerlink" title="day3-17 修改菜品-修改接口开发"></a>day3-17 修改菜品-修改接口开发</h2><p>很简单，建议不看。</p>
<p>controller：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PutMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;修改菜品&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">update</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span>&#123;</span><br><span class="line">    dishService.updateWithFlavor(dishDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateWithFlavor</span><span class="params">(DishDTO dishDTO)</span> &#123;</span><br><span class="line">    Dish dish=<span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">    BeanUtils.copyProperties(dishDTO, dish);</span><br><span class="line">    dishMapper.update(dish);</span><br><span class="line">    dishFlavorMapper.deleteByDishId(dishDTO.getId());</span><br><span class="line">    List&lt;DishFlavor&gt; flavors=dishDTO.getFlavors();</span><br><span class="line">    <span class="keyword">if</span>(flavors!=<span class="literal">null</span> &amp;&amp; flavors.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        flavors.forEach(dishFlavor -&gt; &#123;</span><br><span class="line">            dishFlavor.setDishId(dishDTO.getId());</span><br><span class="line">        &#125;);</span><br><span class="line">        dishFlavorMapper.insertBatch(flavors);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>逻辑：先把之前该菜品的口味全删了，然后重新批量插入。批量插入之前，设置dishId。</p>
<p>mapper（这里只写更新的）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">    update dish</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>name = #&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;categoryId != null&quot;</span>&gt;</span>category_id = #&#123;categoryId&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;price != null&quot;</span>&gt;</span>price = #&#123;price&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;image != null&quot;</span>&gt;</span>image = #&#123;image&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;description != null&quot;</span>&gt;</span>description = #&#123;description&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span>status = #&#123;status&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span>update_time = #&#123;updateTime&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateUser != null&quot;</span>&gt;</span>update_user = #&#123;updateUser&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>都是老套路了，记住就行。</p>
<h2 id="day4-套餐管理模块"><a href="#day4-套餐管理模块" class="headerlink" title="day4 套餐管理模块"></a>day4 套餐管理模块</h2><p>略，没有新知识。</p>
<h2 id="day5-2-Redis入门"><a href="#day5-2-Redis入门" class="headerlink" title="day5-2 Redis入门"></a>day5-2 Redis入门</h2><p>Redis和Mysql都是数据库，但是Redis是内存存储（读写性能高），Mysql在磁盘存储。</p>
<p>Redis基于key-value存储数据。</p>
<p>Redis适合存储热点数据（相当短的时间内大量的访问）。</p>
<h3 id="下载安装启动"><a href="#下载安装启动" class="headerlink" title="下载安装启动"></a>下载安装启动</h3><p>redis直接解压即可使用。</p>
<p><img src="/.io//image-20250720105116659.png"></p>
<p>启动方法：在项目目录下打开终端，输入 <code>.\redis-server.exe .\redis.windows.conf</code></p>
<p><img src="/.io//image-20250720105244822.png"></p>
<p>上面成功打开了服务端，现在打开客户端，新开终端：<code>.\redis-cli.exe</code></p>
<p><img src="/.io//image-20250720105547723.png"></p>
<p>当然客户端可以指定IP和Port：<code>.\redis-cli.exe -h localhost -p 6379</code></p>
<p>现在通过修改配置文件 <code>redis.windows.conf</code> 修改密码，添加这一行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requirepass 123456</span><br></pre></td></tr></table></figure>

<p>现在再在客户端输入命令：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">6379</span>&gt; keys *</span><br><span class="line">(error) NOAUTH Authentication required.</span><br></pre></td></tr></table></figure>

<p>发现无权限。我们通过-a参数输入密码打开客户端：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.\redis-cli.exe -a 123456</span><br><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty list or set)</span><br></pre></td></tr></table></figure>

<p>Redis也可以通过图形界面操作。下载Another-Redis-Desktop-Manager.1.5.5并安装，安装和连接都很简单，略。</p>
<p><img src="/.io//image-20250720111058692.png"></p>
<p>点击左上角的终端符号进入终端：</p>
<p><img src="/.io//image-20250720141019951.png"></p>
<p>在最底下有命令输入栏。</p>
<p>在这里可以选择数据库（总共有16个），注意不同数据库之间的数据完全隔离：</p>
<p><img src="/.io//image-20250720145234100.png"></p>
<h2 id="day5-3-Redis数据类型"><a href="#day5-3-Redis数据类型" class="headerlink" title="day5-3 Redis数据类型"></a>day5-3 Redis数据类型</h2><p>Redis存储k-v数据类型，其中key是字符串，value对应5种常用数据类型：string，hash，list，set，zset (有序set)。</p>
<p><img src="/.io//image-20250720112021000.png"></p>
<p>hash适合存对象（属性+值）；list适用于有顺序的，如朋友圈，可以左插可以右插；set集合，可以计算并集交集等，如计算两人共同朋友；zset，适用于排行榜。</p>
<h2 id="day5-4-Redis命令"><a href="#day5-4-Redis命令" class="headerlink" title="day5-4 Redis命令"></a>day5-4 Redis命令</h2><ol>
<li><strong>字符串类型</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET key value         <span class="comment"># 设置一个字符串值</span></span><br><span class="line">GET key                 <span class="comment"># 获取字符串值</span></span><br><span class="line">DEL key                 <span class="comment"># 删除键</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; <span class="built_in">set</span> name jack</span><br><span class="line">OK</span><br><span class="line">&gt; get name</span><br><span class="line">jack</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>哈希类型</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HSET key field value</span><br><span class="line">HGET key field</span><br><span class="line">HDEL key field</span><br><span class="line">HKEYS key <span class="comment">#获取哈希表中所有字段</span></span><br><span class="line">HVALS key <span class="comment">#获取哈希表所有值</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; hset 100 name xiaoming</span><br><span class="line">1</span><br><span class="line">&gt; hset 100 age 22</span><br><span class="line">1</span><br><span class="line">&gt; hget 100 name</span><br><span class="line">xiaoming</span><br><span class="line">&gt; hget 100 age</span><br><span class="line">22</span><br><span class="line">&gt; hkeys 100</span><br><span class="line">name</span><br><span class="line">age</span><br><span class="line">&gt; hvals 100</span><br><span class="line">xiaoming</span><br><span class="line">22</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p><strong>列表类型</strong></p>
<p>左侧为头部，右侧为尾部，下图帮助理解：</p>
<p><img src="/.io//image-20250720142059284.png"></p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LPUSH key val1 [val2]              <span class="comment"># 向列表头部插入元素（L代表Left，若尾部则RPUSH）</span></span><br><span class="line">LRANGE key start stop              <span class="comment"># 获取列表指定范围内元素</span></span><br><span class="line">LRANGE key 0 -1					<span class="comment"># 获取列表所有元素</span></span><br><span class="line">RPOP key						<span class="comment"># 获取并移除最右侧元素</span></span><br><span class="line">LLEN key						<span class="comment"># 获取元素个数</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt; lpush mylist a b c</span><br><span class="line">3</span><br><span class="line">&gt; lpush mylist d</span><br><span class="line">4</span><br><span class="line">&gt; lrange mylist 0 -1</span><br><span class="line">d</span><br><span class="line">c</span><br><span class="line">b</span><br><span class="line">a</span><br><span class="line">&gt; rpop mylist</span><br><span class="line">a</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>集合类型</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SADD key e1 [e2]              <span class="comment"># 向集合添加元素</span></span><br><span class="line">SREM key e1 [e2]		<span class="comment"># 集合删除元素</span></span><br><span class="line">SMEMBERS key                    <span class="comment"># 获取集合的所有成员</span></span><br><span class="line">SCARD key					<span class="comment"># 获取集合成员数</span></span><br><span class="line">SISMEMBER key e1         <span class="comment"># 检查成员是否在集合中</span></span><br><span class="line">SINTER key1 key2 [key3]   <span class="comment"># 交集</span></span><br><span class="line">SUNION key1 key2 [key3]   <span class="comment"># 并集</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; sadd set1 a b c d</span><br><span class="line">4</span><br><span class="line">&gt; scard set1</span><br><span class="line">4</span><br><span class="line">&gt; sadd set2 a b x y</span><br><span class="line">4</span><br><span class="line">&gt; sinter set1 set2</span><br><span class="line">b</span><br><span class="line">a</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><strong>有序集合类型</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ZADD key score1 member1 [score2 member2]           <span class="comment"># 向有序集合添加成员及其分数</span></span><br><span class="line">ZRANGE key start stop [WITHSCORES]     <span class="comment"># 获取有序集合的所有成员[及其分数]</span></span><br><span class="line">ZINCRBY key increment member           <span class="comment"># 对指定成员分数加上increment（这个命令是指increase by）</span></span><br><span class="line">ZREM key member1 [menber2]             <span class="comment"># 移除成员</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; zadd zset1 10.0 a</span><br><span class="line">1</span><br><span class="line">&gt; zadd zset1 10.5 b</span><br><span class="line">1</span><br><span class="line">&gt; zadd zset1 10.2 c</span><br><span class="line">1</span><br><span class="line">&gt; ZINCRBY zset1 5.0 a</span><br><span class="line">15</span><br><span class="line">&gt; zrange zset1 0 -1 withscores</span><br><span class="line">c</span><br><span class="line">10.199999999999999</span><br><span class="line">b</span><br><span class="line">10.5</span><br><span class="line">a</span><br><span class="line">15</span><br></pre></td></tr></table></figure>

<ol start="6">
<li><strong>通用命令</strong></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">KEYS pattern	<span class="comment"># pattren是指某一个模式，例如*返回所有key</span></span><br><span class="line">EXISTS key</span><br><span class="line">TYPE key</span><br><span class="line">DEL key</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt; keys *</span><br><span class="line">zset1</span><br><span class="line">set1</span><br><span class="line">name</span><br><span class="line">set2</span><br><span class="line">100</span><br><span class="line">mylist</span><br><span class="line">&gt; keys <span class="built_in">set</span>*</span><br><span class="line">set1</span><br><span class="line">set2</span><br></pre></td></tr></table></figure>



<h2 id="day5-10-在-Java-中操作-Redis"><a href="#day5-10-在-Java-中操作-Redis" class="headerlink" title="day5-10 在 Java 中操作 Redis"></a>day5-10 在 Java 中操作 Redis</h2><p>使用官方提供的 <code>Spring Data Redis</code>，它提供了便捷的封装和自动配置，让我们可以像操作普通对象一样使用 Redis。</p>
<p>步骤：引入maven，配置Redis数据源（application.yml），编写配置类，创建RedisTemplate对象，使用RedisTemplate对象操作Redis。</p>
<p>首先是maven：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>配置数据源，application.yml：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">$&#123;sky.redis.host&#125;</span></span><br><span class="line">    <span class="attr">port:</span> <span class="string">$&#123;sky.redis.port&#125;</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">$&#123;sky.redis.password&#125;</span></span><br><span class="line">    <span class="attr">database:</span> <span class="string">$&#123;sky.redis.database&#125;</span></span><br></pre></td></tr></table></figure>

<p>application-dev.yml：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">database:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>编写配置类，sky-server&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;sky&#x2F;config&#x2F;RedisConfiguration.java，对key和value做序列化，RedisTemplate在这里被创建：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span>&#123;</span><br><span class="line">        RedisTemplate redisTemplate=<span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置redis的连接工厂对象</span></span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置redis key的序列化</span></span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用Jackson做value的序列化</span></span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; jacksonSerializer = <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class);</span><br><span class="line">        redisTemplate.setValueSerializer(jacksonSerializer);</span><br><span class="line">        redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">        redisTemplate.setHashValueSerializer(jacksonSerializer);</span><br><span class="line"></span><br><span class="line">        redisTemplate.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建一个测试类sky-server&#x2F;src&#x2F;test&#x2F;java&#x2F;com&#x2F;sky&#x2F;test&#x2F;SpringDataRedisTest.java，采用单元测试 JUnit 5（Jupiter）测试框架，自动注入RedisTemplate对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringDataRedisTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testRedisTemplate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 看是否创建成功</span></span><br><span class="line">        System.out.println(redisTemplate);</span><br><span class="line"></span><br><span class="line">        ValueOperations valueOperations=redisTemplate.opsForValue();</span><br><span class="line">        HashOperations hashOperations=redisTemplate.opsForHash();</span><br><span class="line">        ListOperations listOperations=redisTemplate.opsForList();</span><br><span class="line">        SetOperations setOperations=redisTemplate.opsForSet();</span><br><span class="line">        ZSetOperations zSetOperations=redisTemplate.opsForZSet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testString</span><span class="params">()</span>&#123;</span><br><span class="line">        ValueOperations valueOperations=redisTemplate.opsForValue();</span><br><span class="line">        valueOperations.set(<span class="string">&quot;city&quot;</span>,<span class="string">&quot;北京beijing&quot;</span>);</span><br><span class="line">        System.out.println((String)valueOperations.get(<span class="string">&quot;city&quot;</span>)); <span class="comment">// 输出 北京beijing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行后成功在redis查找到存入的数据：</p>
<p><img src="/.io//image-20250720151619962.png"></p>
<p>我们还可以继续测试 Hash 数据类型：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testHash</span><span class="params">()</span> &#123;</span><br><span class="line">    HashOperations hashOperations=redisTemplate.opsForHash();</span><br><span class="line">    hashOperations.put(<span class="string">&quot;100&quot;</span>,<span class="string">&quot;名字&quot;</span>,<span class="string">&quot;张哥&quot;</span>);</span><br><span class="line">    hashOperations.put(<span class="string">&quot;100&quot;</span>,<span class="string">&quot;年龄&quot;</span>,<span class="string">&quot;19&quot;</span>);</span><br><span class="line">    String name=(String)hashOperations.get(<span class="string">&quot;100&quot;</span>,<span class="string">&quot;名字&quot;</span>);</span><br><span class="line">    System.out.println(name); <span class="comment">//输出张哥</span></span><br><span class="line"></span><br><span class="line">    Set keys=hashOperations.keys(<span class="string">&quot;100&quot;</span>);</span><br><span class="line">    System.out.println(keys);</span><br><span class="line">    List values=hashOperations.values(<span class="string">&quot;100&quot;</span>);</span><br><span class="line">    System.out.println(values);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">张哥</span><br><span class="line">[名字, 年龄]</span><br><span class="line">[张哥, 19]</span><br></pre></td></tr></table></figure>

<p>其他类型都差不多，略过了。</p>
<h2 id="day5-15-店铺营业状态设置-需求分析"><a href="#day5-15-店铺营业状态设置-需求分析" class="headerlink" title="day5-15 店铺营业状态设置-需求分析"></a>day5-15 店铺营业状态设置-需求分析</h2><p><img src="/.io//image-20250720154526362.png"></p>
<p>那么我们怎么存储这个营业状态呢？可以基于Redis的字符串存储！</p>
<p>key：SHOP_STATUS</p>
<p>value：0或1</p>
<h2 id="day5-16-店铺营业状态设置-代码开发"><a href="#day5-16-店铺营业状态设置-代码开发" class="headerlink" title="day5-16 店铺营业状态设置-代码开发"></a>day5-16 店铺营业状态设置-代码开发</h2><p>先把测试类注释掉。</p>
<p>然后直接写控制器（因为逻辑简单，直接写在控制器里了）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin/shop&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;status&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">setStatus</span><span class="params">(<span class="meta">@PathVariable</span> Integer status)</span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;SHOP_STATUS&quot;</span>,status);</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/status&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Integer&gt; <span class="title function_">getStatus</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success((Integer)redisTemplate.opsForValue().get(<span class="string">&quot;SHOP_STATUS&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在用户端也创建一个控制器，这是我们的第一个用户端控制器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController(&quot;userShopController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/shop&quot;)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShopController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/status&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result&lt;Integer&gt; <span class="title function_">getStatus</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success((Integer)redisTemplate.opsForValue().get(<span class="string">&quot;SHOP_STATUS&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于两个都叫ShopController，Spring管理Bean时候发现这两个Bean重名，因此冲突。我们解决方案就是加上@RestController(“userShopController”)。</p>
<p>现在我们修改一下swagger配置，因为现在用户和管理员的接口混在一起，不好区分，因此我们分成两页面：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ApiInfo</span> <span class="variable">apiInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">        .title(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">        .version(<span class="string">&quot;2.0&quot;</span>)</span><br><span class="line">        .description(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">    <span class="type">Docket</span> <span class="variable">docket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">        .groupName(<span class="string">&quot;管理端接口&quot;</span>)</span><br><span class="line">        .apiInfo(apiInfo)</span><br><span class="line">        .select()</span><br><span class="line">        .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sky.controller.admin&quot;</span>))</span><br><span class="line">        .paths(PathSelectors.any())</span><br><span class="line">        .build();</span><br><span class="line">    <span class="keyword">return</span> docket;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Docket <span class="title function_">docket2</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ApiInfo</span> <span class="variable">apiInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ApiInfoBuilder</span>()</span><br><span class="line">        .title(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">        .version(<span class="string">&quot;2.0&quot;</span>)</span><br><span class="line">        .description(<span class="string">&quot;苍穹外卖项目接口文档&quot;</span>)</span><br><span class="line">        .build();</span><br><span class="line">    <span class="type">Docket</span> <span class="variable">docket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Docket</span>(DocumentationType.SWAGGER_2)</span><br><span class="line">        .groupName(<span class="string">&quot;用户端接口&quot;</span>)</span><br><span class="line">        .apiInfo(apiInfo)</span><br><span class="line">        .select()</span><br><span class="line">        .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.sky.controller.user&quot;</span>))</span><br><span class="line">        .paths(PathSelectors.any())</span><br><span class="line">        .build();</span><br><span class="line">    <span class="keyword">return</span> docket;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="day6-2-HttpClient"><a href="#day6-2-HttpClient" class="headerlink" title="day6-2 HttpClient"></a>day6-2 HttpClient</h2><p><code>HttpClient</code> 是一个用于在Java程序通过编码的方式发送 HTTP 请求的工具。</p>
<p>可以模拟发 GET、POST、PUT、DELETE 等请求，并接收请求的响应。</p>
<h3 id="发送GET请求"><a href="#发送GET请求" class="headerlink" title="发送GET请求"></a>发送GET请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGET</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">//创建httpClient对象</span></span><br><span class="line">    <span class="comment">//CloseableHttpClient 实现了 HttpClient</span></span><br><span class="line">    CloseableHttpClient httpClient= HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建请求对象</span></span><br><span class="line">    HttpGet httpGet=<span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;http://localhost:8080/user/shop/status&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发送请求</span></span><br><span class="line">    CloseableHttpResponse response=httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取状态码</span></span><br><span class="line">    System.out.println(<span class="string">&quot;status code:&quot;</span>+response.getStatusLine().getStatusCode());<span class="comment">//status code:200</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取响应数据</span></span><br><span class="line">    HttpEntity entity=response.getEntity();</span><br><span class="line">    String body=EntityUtils.toString(entity);</span><br><span class="line">    System.out.println(<span class="string">&quot;data:&quot;</span>+body);<span class="comment">//data:&#123;&quot;code&quot;:1,&quot;msg&quot;:null,&quot;data&quot;:0&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//关闭资源</span></span><br><span class="line">    response.close();</span><br><span class="line">    httpClient.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="发送POST请求"><a href="#发送POST请求" class="headerlink" title="发送POST请求"></a>发送POST请求</h3><p>需要用JSONObject构建一个json的请求。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testPOST</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    CloseableHttpClient httpClient= HttpClients.createDefault();</span><br><span class="line">    HttpPost httpPost=<span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;http://localhost:8080/admin/employee/login&quot;</span>);</span><br><span class="line"></span><br><span class="line">    JSONObject jsonObject=<span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">    jsonObject.put(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    jsonObject.put(<span class="string">&quot;password&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    StringEntity entity=<span class="keyword">new</span> <span class="title class_">StringEntity</span>(jsonObject.toString());</span><br><span class="line">    entity.setContentEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">    entity.setContentType(<span class="string">&quot;application/json&quot;</span>);</span><br><span class="line">    httpPost.setEntity(entity);</span><br><span class="line"></span><br><span class="line">    CloseableHttpResponse response=httpClient.execute(httpPost);</span><br><span class="line"></span><br><span class="line">    HttpEntity httpEntity=response.getEntity();</span><br><span class="line">    String body=EntityUtils.toString(httpEntity);</span><br><span class="line">    System.out.println(<span class="string">&quot;data:&quot;</span>+body);</span><br><span class="line"></span><br><span class="line">    response.close();</span><br><span class="line">    httpClient.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了便于后续使用，封装为工具类：sky-common&#x2F;src&#x2F;main&#x2F;java&#x2F;com&#x2F;sky&#x2F;utils&#x2F;HttpClientUtil.java。</p>
<h2 id="day6-6-微信小程序开发-准备工作"><a href="#day6-6-微信小程序开发-准备工作" class="headerlink" title="day6-6 微信小程序开发-准备工作"></a>day6-6 微信小程序开发-准备工作</h2><p>首先注册。</p>
<p><img src="/.io//image-20250720223753707.png"></p>
<p>已注册就右侧点击立即登录，完善信息。</p>
<p><img src="/.io//image-20250720224026595.png"></p>
<p>保存小程序ID和密钥。</p>
<p><img src="/.io//image-20250720224334148.png"></p>
<p>下载微信开发者工具。</p>
<p><img src="/.io//image-20250720225036330.png"></p>
<p>点击加号新建小程序，选择如下：</p>
<p><img src="/.io//image-20250720225347968.png"></p>
<p>在详情-本地设置中把以下选项打勾：</p>
<p><img src="/.io//image-20250720225540307.png"></p>
<p>调试基础库调整为2.xx.xx：</p>
<p><img src="/.io//image-20250721091301671.png"></p>
<p>小程序目录结构：</p>
<p><img src="/.io//image-20250721084228558.png"></p>
<p><img src="/.io//image-20250721084454456.png"></p>
<h2 id="day6-8-微信小程序开发入门"><a href="#day6-8-微信小程序开发入门" class="headerlink" title="day6-8 微信小程序开发入门"></a>day6-8 微信小程序开发入门</h2><p>wxml中的<code>&lt;view&gt;</code>标签，类似于html中的<code>&lt;div&gt;</code>标签。</p>
<table>
<thead>
<tr>
<th>Vue Template</th>
<th>WXML 语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;div&gt;&#123;&#123; msg &#125;&#125;&lt;/div&gt;</code></td>
<td><code>&lt;view&gt;&#123;&#123; msg &#125;&#125;&lt;/view&gt;</code></td>
<td>只能使用小程序内置组件</td>
</tr>
<tr>
<td><code>v-if=&quot;ok&quot;</code></td>
<td><code>wx:if=&quot;&#123;&#123;ok&#125;&#125;&quot;</code></td>
<td>条件渲染</td>
</tr>
<tr>
<td><code>v-for=&quot;item in list&quot;</code></td>
<td><code>wx:for=&quot;&#123;&#123;list&#125;&#125;&quot;</code></td>
<td>列表渲染</td>
</tr>
<tr>
<td><code>@click=&quot;clickFn&quot;</code></td>
<td><code>bindtap=&quot;clickFn&quot;</code></td>
<td>事件绑定</td>
</tr>
</tbody></table>
<p>js类似于vue：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&quot;Hello World&quot;</span>,</span><br><span class="line">    <span class="attr">items</span>: [&#123;<span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;A&quot;</span>&#125;, &#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;B&quot;</span>&#125;]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;页面加载&quot;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">clickFn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123; <span class="attr">msg</span>: <span class="string">&quot;Clicked!&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>现在让我们写一个简单的小程序：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span>&gt;</span>欢迎来到小程序<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;message&quot;</span>&gt;</span>&#123;&#123;message&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">bindtap</span>=<span class="string">&quot;changeList&quot;</span>&gt;</span>更新列表<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;items&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">class</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">      &#123;&#123;index + 1&#125;&#125;. &#123;&#123;item.name&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;初始列表如下：&#x27;</span>,</span><br><span class="line">    <span class="attr">items</span>: [</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&#x27;苹果&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&#x27;香蕉&#x27;</span> &#125;,</span><br><span class="line">      &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&#x27;橘子&#x27;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="title function_">changeList</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;列表已更新：&#x27;</span>,</span><br><span class="line">      <span class="attr">items</span>: [</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">4</span>, <span class="attr">name</span>: <span class="string">&#x27;葡萄&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">5</span>, <span class="attr">name</span>: <span class="string">&#x27;西瓜&#x27;</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">id</span>: <span class="number">6</span>, <span class="attr">name</span>: <span class="string">&#x27;芒果&#x27;</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>效果：</p>
<p><img src="/.io//image-20250721092543262.png"></p>
<h2 id="day6-15-微信登录-JWT-HttpClient"><a href="#day6-15-微信登录-JWT-HttpClient" class="headerlink" title="day6-15 微信登录 (JWT, HttpClient)"></a>day6-15 微信登录 (JWT, HttpClient)</h2><p>这里的开发者服务器就是指我们的后端。</p>
<p>后端服务器请求微信接口服务，需要使用之前的HttpClient。</p>
<p>自定义登录态：我们这里使用Token。</p>
<p><img src="/.io//api-login.2fcc9f35.jpg"></p>
<p><img src="/.io//image-20250721092858606.png"></p>
<p><img src="/.io//image-20250721092923639.png"></p>
<p>现在进入后端代码开发，首先配置微信小程序id和密钥：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">wechat:</span></span><br><span class="line">    <span class="attr">appid:</span> <span class="string">$&#123;sky.wechat.appid&#125;</span></span><br><span class="line">    <span class="attr">secret:</span> <span class="string">$&#123;sky.wechat.secret&#125;</span></span><br></pre></td></tr></table></figure>

<p>配置用户端的jwt：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sky:</span></span><br><span class="line">  <span class="attr">jwt:</span></span><br><span class="line">    <span class="attr">admin-secret-key:</span> <span class="string">itcast</span></span><br><span class="line">    <span class="attr">admin-ttl:</span> <span class="number">7200000</span></span><br><span class="line">    <span class="attr">admin-token-name:</span> <span class="string">token</span></span><br><span class="line">    <span class="attr">user-secret-key:</span> <span class="string">itheima</span></span><br><span class="line">    <span class="attr">user-ttl:</span> <span class="number">7200000</span></span><br><span class="line">    <span class="attr">user-token-name:</span> <span class="string">authentication</span></span><br></pre></td></tr></table></figure>

<p>接下来开始写控制器，在写控制器之前先确定参数和返回值，虽然这里参数只有一个code，但还是给封装到DTO中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserLoginDTO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时封装VO：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserLoginVO</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String openid;</span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建controller：</p>
<p>这里User类的字段，和上面的数据库一致。</p>
<p>先调用service，获取User对象（获取openid），然后给用户创建jwt令牌token，随后把openid，token，用户主键封装为VO返回。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;UserLoginVO&gt; <span class="title function_">login</span><span class="params">(<span class="meta">@RequestBody</span> UserLoginDTO userLoginDTO)</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.wxLogin(userLoginDTO);</span><br><span class="line">    Map&lt;String, Object&gt; claims=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    claims.put(JwtClaimsConstant.USER_ID,user.getId());</span><br><span class="line">    String token=JwtUtil.createJWT(jwtProperties.getUserSecretKey(), jwtProperties.getUserTtl(), claims);</span><br><span class="line">    UserLoginVO userLoginVO=UserLoginVO.builder()</span><br><span class="line">        .id(user.getId())</span><br><span class="line">        .openid(user.getOpenid())</span><br><span class="line">        .token(token)</span><br><span class="line">        .build();</span><br><span class="line">    <span class="keyword">return</span> Result.success(userLoginVO);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在写service：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String WX_LOGIN=<span class="string">&quot;https://api.weixin.qq.com/sns/jscode2session&quot;</span>;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WeChatProperties weChatProperties;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">wxLogin</span><span class="params">(UserLoginDTO userLoginDTO)</span> &#123;</span><br><span class="line">        Map&lt;String,String&gt; map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;appid&quot;</span>,weChatProperties.getAppid());</span><br><span class="line">        map.put(<span class="string">&quot;secret&quot;</span>,weChatProperties.getSecret());</span><br><span class="line">        map.put(<span class="string">&quot;js_code&quot;</span>, userLoginDTO.getCode());</span><br><span class="line">        map.put(<span class="string">&quot;grant_type&quot;</span>, <span class="string">&quot;authorization_code&quot;</span>);</span><br><span class="line">        String json= HttpClientUtil.doGet(WX_LOGIN,map);</span><br><span class="line"></span><br><span class="line">        JSONObject jsonObject= JSON.parseObject(json);</span><br><span class="line">        String openid=jsonObject.getString(<span class="string">&quot;openid&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(openid==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LoginFailedException</span>(MessageConstant.LOGIN_FAILED);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        User user=userMapper.getByOpenid(openid);</span><br><span class="line">        <span class="keyword">if</span>(user==<span class="literal">null</span>)&#123;</span><br><span class="line">            user=User.builder()</span><br><span class="line">                    .openid(openid)</span><br><span class="line">                    .createTime(LocalDateTime.now())</span><br><span class="line">                    .build();</span><br><span class="line">            userMapper.insert(user);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先构造请求向微信的api通过HttpClient发送，返回并提取openid，然后判断该用户是否在数据库存在，如果不存在就插入用户数据，如果存在直接返回user。</p>
<p>mapper代码略。</p>
<p>现在通过小程序来测试一下登录：</p>
<p>![](屏幕截图 2025-07-21 104438.png)</p>
<p>![](屏幕截图 2025-07-21 104443.png)</p>
<p>最后，我们需要创建JWT拦截器，用于身份的校验。首先在interceptor包下面创建一个JwtTokenUserInterceptor：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.sky.constant.JwtClaimsConstant;</span><br><span class="line"><span class="keyword">import</span> com.sky.context.BaseContext;</span><br><span class="line"><span class="keyword">import</span> com.sky.properties.JwtProperties;</span><br><span class="line"><span class="keyword">import</span> com.sky.utils.JwtUtil;</span><br><span class="line"><span class="keyword">import</span> io.jsonwebtoken.Claims;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.method.HandlerMethod;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * jwt令牌校验的拦截器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtTokenUserInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JwtProperties jwtProperties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//判断当前拦截到的是Controller的方法还是其他资源</span></span><br><span class="line">        <span class="keyword">if</span> (!(handler <span class="keyword">instanceof</span> HandlerMethod)) &#123;</span><br><span class="line">            <span class="comment">//当前拦截到的不是动态方法，直接放行</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1、从请求头中获取令牌</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> request.getHeader(jwtProperties.getUserTokenName());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2、校验令牌</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;jwt校验:&#123;&#125;&quot;</span>, token);</span><br><span class="line">            <span class="type">Claims</span> <span class="variable">claims</span> <span class="operator">=</span> JwtUtil.parseJWT(jwtProperties.getUserSecretKey(), token);</span><br><span class="line">            <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> Long.valueOf(claims.get(JwtClaimsConstant.USER_ID).toString());</span><br><span class="line">            log.info(<span class="string">&quot;当前用户id：&quot;</span>, userId);</span><br><span class="line">            BaseContext.setCurrentId(userId);</span><br><span class="line">            <span class="comment">//3、通过，放行</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            <span class="comment">//4、不通过，响应401状态码</span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在配置类WebMvcConfiguration中进行注册：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;开始注册自定义拦截器...&quot;</span>);</span><br><span class="line">    registry.addInterceptor(jwtTokenAdminInterceptor)</span><br><span class="line">        .addPathPatterns(<span class="string">&quot;/admin/**&quot;</span>)</span><br><span class="line">        .excludePathPatterns(<span class="string">&quot;/admin/employee/login&quot;</span>);</span><br><span class="line">    registry.addInterceptor(jwtTokenUserInterceptor)</span><br><span class="line">        .addPathPatterns(<span class="string">&quot;/user/**&quot;</span>)</span><br><span class="line">        .excludePathPatterns(<span class="string">&quot;/user/user/login&quot;</span>)</span><br><span class="line">        .excludePathPatterns(<span class="string">&quot;/user/shop/status&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="day6-19-商品浏览-代码导入"><a href="#day6-19-商品浏览-代码导入" class="headerlink" title="day6-19 商品浏览-代码导入"></a>day6-19 商品浏览-代码导入</h2><p>产品原型：</p>
<p><img src="/.io//image-20250721105844902.png"></p>
<p>导入代码（略）</p>
<h2 id="day7-2-缓存菜品-代码开发-Redis"><a href="#day7-2-缓存菜品-代码开发-Redis" class="headerlink" title="day7-2 缓存菜品-代码开发 (Redis)"></a>day7-2 缓存菜品-代码开发 (Redis)</h2><p><img src="/.io//image-20250721140451902.png"></p>
<p>key：分类ID，dish_categoryId</p>
<p>value：字符串，每个分类下的菜品List</p>
<p>菜品有变更的时候需要及时清理缓存数据。</p>
<p>现在让我们开始实现代码：</p>
<p>首先是user下的DishController：</p>
<p>先注入RedisTemplate：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate redisTemplate;</span><br></pre></td></tr></table></figure>

<p><strong>改造控制器逻辑！！！</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;根据分类id查询菜品&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;DishVO&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">    String key=<span class="string">&quot;dish_&quot;</span>+categoryId;<span class="comment">//构造key</span></span><br><span class="line">    List&lt;DishVO&gt; list= (List&lt;DishVO&gt;) redisTemplate.opsForValue().get(key);<span class="comment">//查询redis</span></span><br><span class="line">    <span class="keyword">if</span>(list!=<span class="literal">null</span>&amp;&amp;list.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.success(list);<span class="comment">//返回缓存</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//缓存不存在，从数据库查</span></span><br><span class="line">    <span class="type">Dish</span> <span class="variable">dish</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Dish</span>();</span><br><span class="line">    dish.setCategoryId(categoryId);</span><br><span class="line">    dish.setStatus(StatusConstant.ENABLE);<span class="comment">//查询起售中的菜品</span></span><br><span class="line"></span><br><span class="line">    list = dishService.listWithFlavor(dish);</span><br><span class="line">    redisTemplate.opsForValue().set(key,list);<span class="comment">//存入缓存</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后测试。测试过程中出现报错：Jackson 默认 不支持 Java 8 时间类（如 <code>LocalDateTime</code>）的序列化与反序列化，Redis 序列化时使用的是默认的 <code>ObjectMapper</code>，从而无法识别 <code>LocalDateTime</code>。</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">com.fasterxml.jackson.databind.exc.InvalidDefinitionException: <span class="title">Java</span> 8 <span class="title">date</span>/<span class="title">time</span> <span class="title">type</span> <span class="title">java.time.LocalDateTime</span> <span class="title">not</span> <span class="title">supported</span> <span class="title">by</span> <span class="title">default</span>: <span class="title">add</span> <span class="title">Module</span> &quot;<span class="title">com.fasterxml.jackson.datatype:jackson</span>-<span class="title">datatype</span>-<span class="title">jsr310</span>&quot; <span class="title">to</span> <span class="title">enable</span> <span class="title">handling</span> (<span class="title">through</span> <span class="title">reference</span> <span class="title">chain</span>: <span class="title">java.util.ArrayList</span>[0]-&gt;<span class="title">com.sky.vo.DishVO</span>[&quot;<span class="title">updateTime</span>&quot;])</span></span><br></pre></td></tr></table></figure>

<p>解决方案：我们之前写过一个自定义的 <code>ObjectMapper</code> ：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JacksonObjectMapper</span> <span class="keyword">extends</span> <span class="title class_">ObjectMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DATE_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd&quot;</span>;</span><br><span class="line">    <span class="comment">//public static final String DEFAULT_DATE_TIME_FORMAT = &quot;yyyy-MM-dd HH:mm:ss&quot;;</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DATE_TIME_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;yyyy-MM-dd HH:mm&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_TIME_FORMAT</span> <span class="operator">=</span> <span class="string">&quot;HH:mm:ss&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JacksonObjectMapper</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>();</span><br><span class="line">        <span class="comment">//收到未知属性时不报异常</span></span><br><span class="line">        <span class="built_in">this</span>.configure(FAIL_ON_UNKNOWN_PROPERTIES, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//反序列化时，属性不存在的兼容处理</span></span><br><span class="line">        <span class="built_in">this</span>.getDeserializationConfig().withoutFeatures(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line"></span><br><span class="line">        <span class="type">SimpleModule</span> <span class="variable">simpleModule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleModule</span>()</span><br><span class="line">            .addDeserializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">            .addDeserializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">            .addDeserializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeDeserializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)))</span><br><span class="line">            .addSerializer(LocalDateTime.class, <span class="keyword">new</span> <span class="title class_">LocalDateTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_TIME_FORMAT)))</span><br><span class="line">            .addSerializer(LocalDate.class, <span class="keyword">new</span> <span class="title class_">LocalDateSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_DATE_FORMAT)))</span><br><span class="line">            .addSerializer(LocalTime.class, <span class="keyword">new</span> <span class="title class_">LocalTimeSerializer</span>(DateTimeFormatter.ofPattern(DEFAULT_TIME_FORMAT)));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//注册功能模块 例如，可以添加自定义序列化器和反序列化器</span></span><br><span class="line">        <span class="built_in">this</span>.registerModule(simpleModule);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在Redis配置中，手动传入自定义的 <code>ObjectMapper</code> 给 <code>Jackson2JsonRedisSerializer</code>即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> RedisTemplate <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span>&#123;</span><br><span class="line">    RedisTemplate redisTemplate=<span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置redis的连接工厂对象</span></span><br><span class="line">    redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置redis key的序列化</span></span><br><span class="line">    redisTemplate.setKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用自定义的 ObjectMapper</span></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">objectMapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JacksonObjectMapper</span>();</span><br><span class="line">    Jackson2JsonRedisSerializer&lt;Object&gt; jacksonSerializer = <span class="keyword">new</span> <span class="title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(Object.class);</span><br><span class="line">    jacksonSerializer.setObjectMapper(objectMapper);</span><br><span class="line">    <span class="comment">// 使用Jackson做value的序列化</span></span><br><span class="line">    redisTemplate.setValueSerializer(jacksonSerializer);</span><br><span class="line">    redisTemplate.setHashKeySerializer(<span class="keyword">new</span> <span class="title class_">StringRedisSerializer</span>());</span><br><span class="line">    redisTemplate.setHashValueSerializer(jacksonSerializer);</span><br><span class="line"></span><br><span class="line">    redisTemplate.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> redisTemplate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，有一个问题，<strong>缓存和数据库的数据可能出现不一致的问题</strong>，当管理员修改&#x2F;停售&#x2F;菜品&#x2F;删除菜品的时候，redis缓存的数据需要被清除！！</p>
<p>因此还需要修改管理端的controller：</p>
<p>以新增菜品举例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;新增菜品&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> DishDTO dishDTO)</span>&#123;</span><br><span class="line">    dishService.saveWithFlavor(dishDTO);</span><br><span class="line">    String key=<span class="string">&quot;dish_&quot;</span>+dishDTO.getCategoryId();</span><br><span class="line">    redisTemplate.delete(key);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实这里可以抽取这个公共方法，然后采用面向切片编程，时间紧张，先略过。</p>
<h2 id="day7-6-Spring-Cache-框架使用"><a href="#day7-6-Spring-Cache-框架使用" class="headerlink" title="day7-6 Spring Cache 框架使用"></a>day7-6 Spring Cache 框架使用</h2><p>基于<strong>注解</strong>的缓存功能，只需要加一个注解就可以实现缓存。</p>
<p>要使用需要导入maven。</p>
<table>
<thead>
<tr>
<th>注解</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td><code>@EnableCaching</code></td>
<td>开启 Spring 缓存功能，通常在启动类</td>
</tr>
<tr>
<td><code>@Cacheable</code></td>
<td>方法执行前查询缓存是否有数据，如果有就返回缓存数据，如果没有就调用方法并把返回值放到缓存中</td>
</tr>
<tr>
<td><code>@CachePut</code></td>
<td>执行方法并把返回值放入缓存（更新缓存）</td>
</tr>
<tr>
<td><code>@CacheEvict</code></td>
<td>清除一条或多条缓存</td>
</tr>
<tr>
<td><code>@Caching</code></td>
<td>组合多个缓存注解使用</td>
</tr>
</tbody></table>
<p>让我们结合一个示例工程了解一下用法。第一步在启动类上加<code>@EnableCaching</code>，代码就不贴了。</p>
<p>第二步就是在controller上面加注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@CachePut(cacheNames = &quot;userCache&quot;, key = &quot;#user.id&quot;)</span></span><br><span class="line"><span class="comment">//SpringCache框架中，key的生成为 cacheNames::key</span></span><br><span class="line"><span class="comment">//例如上面就是userCache_1, &quot;#user.id&quot;中user是方法传入的参数, 这个是SpEL表达式</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">    userMapper.insert(user);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试结果：redis和mysql都被插入这条数据。</p>
<p><img src="/.io//image-20250721154840194.png"></p>
<p>接下来使用<code>@Cacheable</code>，在查询的controller上面加上该注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span></span><br><span class="line"><span class="meta">@Cacheable(cacheNames = &quot;userCache&quot;, key = &quot;#id&quot;)</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">getById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.getById(id);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试结果：成功从缓存查询。如果数据库有数据，缓存没有数据，会调用方法把数据放到缓存里。如果在缓存能查到，他压根不会执行控制器方法。</p>
<p>删除也加上：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = &quot;userCache&quot;, key = &quot;#id&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(Long id)</span>&#123;</span><br><span class="line">    userMapper.deleteById(id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DeleteMapping(&quot;/delAll&quot;)</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = &quot;userCache&quot;, allEntries = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteAll</span><span class="params">()</span>&#123;</span><br><span class="line">    userMapper.deleteAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="day7-11-缓存套餐-代码开发-Spring-Cache"><a href="#day7-11-缓存套餐-代码开发-Spring-Cache" class="headerlink" title="day7-11 缓存套餐-代码开发 (Spring Cache)"></a>day7-11 缓存套餐-代码开发 (Spring Cache)</h2><p>com&#x2F;sky&#x2F;controller&#x2F;<strong>user</strong>&#x2F;SetmealController.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/list&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;根据分类id查询套餐&quot;)</span></span><br><span class="line"><span class="meta">@Cacheable(cacheNames = &quot;setmealCache&quot;,key = &quot;#categoryId&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result&lt;List&lt;Setmeal&gt;&gt; <span class="title function_">list</span><span class="params">(Long categoryId)</span> &#123;</span><br><span class="line">    <span class="type">Setmeal</span> <span class="variable">setmeal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Setmeal</span>();</span><br><span class="line">    setmeal.setCategoryId(categoryId);</span><br><span class="line">    setmeal.setStatus(StatusConstant.ENABLE);</span><br><span class="line"></span><br><span class="line">    List&lt;Setmeal&gt; list = setmealService.list(setmeal);</span><br><span class="line">    <span class="keyword">return</span> Result.success(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>com&#x2F;sky&#x2F;controller&#x2F;<strong>admin</strong>&#x2F;SetmealController.java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;, key = &quot;#setmealDTO.categoryId&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> SetmealDTO setmealDTO)</span>&#123;</span><br><span class="line">    setmealService.saveWithDish(setmealDTO);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@DeleteMapping</span></span><br><span class="line"><span class="meta">@CacheEvict(cacheNames = &quot;setmealCache&quot;, allEntries = true)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">delete</span><span class="params">(<span class="meta">@RequestParam</span> List&lt;Long&gt; ids)</span>&#123;</span><br><span class="line">    setmealService.delete(ids);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其余代码略。</p>
<h2 id="day7-13-添加购物车"><a href="#day7-13-添加购物车" class="headerlink" title="day7-13 添加购物车"></a>day7-13 添加购物车</h2><p><img src="/.io//image-20250721164206520.png"></p>
<p>可能传入菜品（无口味），菜品（有口味），套餐，因此接口设计：</p>
<p><img src="/.io//image-20250721164315885.png"></p>
<p>设计一下购物车的数据库表，每个用户的购物车需要区分开来（注意购物车也需要持久化，因为我可能查询历史购物信息，还有就是如果我还没点完退出了，下一次登录，我应该还能保留上次没点完的继续点）：</p>
<p><img src="/.io//image-20250721164528693.png"></p>
<p>现在开始代码开发，DTO已经封装完毕，字段和Body一致，略。</p>
<p>控制器很简单，直接调用service就结束了，略。</p>
<p>服务层，注意userId是通过BaseContext拿到的，也就是jwt解析token并放到ThreadLocal中，我们可以直接取。</p>
<p>代码就不写了。看一下结果：</p>
<p><img src="/.io//image-20250722084622269.png"></p>
<p>注意同一个菜品不同口味是分开不同项的。</p>
<h2 id="day7-18-查看购物车-清空购物车"><a href="#day7-18-查看购物车-清空购物车" class="headerlink" title="day7-18 查看购物车-清空购物车"></a>day7-18 查看购物车-清空购物车</h2><p>查看购物车和清空购物车完全不需要传入参数，因为用户ID通过ThreadLocal即可获取。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;ShoppingCart&gt; <span class="title function_">showShoppingCart</span><span class="params">()</span> &#123;</span><br><span class="line">    Long userId=BaseContext.getCurrentId();</span><br><span class="line">    ShoppingCart shoppingCart=ShoppingCart.builder()</span><br><span class="line">        .userId(userId)</span><br><span class="line">        .build();</span><br><span class="line">    <span class="keyword">return</span> shoppingCartMapper.list(shoppingCart);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其他代码都很简单，略。</p>
<h2 id="day8-2-地址簿代码导入"><a href="#day8-2-地址簿代码导入" class="headerlink" title="day8-2 地址簿代码导入"></a>day8-2 地址簿代码导入</h2><p><img src="/.io//image-20250722090842201.png"></p>
<p>导入略。</p>
<h2 id="day8-5-用户下单"><a href="#day8-5-用户下单" class="headerlink" title="day8-5 用户下单"></a>day8-5 用户下单</h2><p><img src="/.io//image-20250722095214411.png"></p>
<p><img src="/.io//image-20250722095747173.png"></p>
<p><img src="/.io//image-20250722100010259.png"></p>
<p>只给service代码，其他略：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> OrderSubmitVO <span class="title function_">submitOrder</span><span class="params">(OrdersSubmitDTO ordersSubmitDTO)</span> &#123;</span><br><span class="line">    <span class="comment">//处理业务异常，地址为空？购物车为空？</span></span><br><span class="line">    AddressBook addressBook=addressBookMapper.getById(ordersSubmitDTO.getAddressBookId());</span><br><span class="line">    <span class="keyword">if</span>(addressBook==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AddressBookBusinessException</span>(MessageConstant.ADDRESS_BOOK_IS_NULL);</span><br><span class="line">    &#125;</span><br><span class="line">    Long userId= BaseContext.getCurrentId();</span><br><span class="line">    ShoppingCart shoppingCart=<span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line">    shoppingCart.setUserId(userId);</span><br><span class="line">    List&lt;ShoppingCart&gt; shoppingCartList=shoppingCartMapper.list(shoppingCart);</span><br><span class="line">    <span class="keyword">if</span>(shoppingCartList==<span class="literal">null</span>||shoppingCartList.size()==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ShoppingCartBusinessException</span>(MessageConstant.SHOPPING_CART_IS_NULL);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//订单表插入一条</span></span><br><span class="line">    <span class="comment">//手动检查每一个字段是否填充</span></span><br><span class="line">    Orders orders=<span class="keyword">new</span> <span class="title class_">Orders</span>();</span><br><span class="line">    BeanUtils.copyProperties(ordersSubmitDTO,orders);</span><br><span class="line">    orders.setOrderTime(LocalDateTime.now());</span><br><span class="line">    orders.setPayStatus(Orders.UN_PAID);</span><br><span class="line">    orders.setStatus(Orders.PENDING_PAYMENT);</span><br><span class="line">    orders.setNumber(String.valueOf(System.currentTimeMillis()));</span><br><span class="line">    orders.setPhone(addressBook.getPhone());</span><br><span class="line">    orders.setConsignee(addressBook.getConsignee());</span><br><span class="line">    orders.setUserId(userId);</span><br><span class="line">    orderMapper.insert(orders);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//订单明细表插入n条</span></span><br><span class="line">    List&lt;OrderDetail&gt; orderDetailList=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(ShoppingCart cart:shoppingCartList)&#123;</span><br><span class="line">        OrderDetail orderDetail=<span class="keyword">new</span> <span class="title class_">OrderDetail</span>();</span><br><span class="line">        BeanUtils.copyProperties(cart,orderDetail);</span><br><span class="line">        orderDetail.setOrderId(orders.getId());</span><br><span class="line">        orderDetailList.add(orderDetail);</span><br><span class="line">    &#125;</span><br><span class="line">    orderDetailMapper.insertBatch(orderDetailList);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//清空购物车</span></span><br><span class="line">    shoppingCartMapper.deleteByUserId(userId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//封装VO返回</span></span><br><span class="line">    OrderSubmitVO orderSubmitVO=OrderSubmitVO.builder()</span><br><span class="line">        .id(orders.getId())</span><br><span class="line">        .orderTime(orders.getOrderTime())</span><br><span class="line">        .orderNumber(orders.getNumber())</span><br><span class="line">        .orderAmount(orders.getAmount())</span><br><span class="line">        .build();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> orderSubmitVO;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="day8-12-微信支付-cpolar-内网穿透"><a href="#day8-12-微信支付-cpolar-内网穿透" class="headerlink" title="day8-12 微信支付 (cpolar 内网穿透)"></a>day8-12 微信支付 (cpolar 内网穿透)</h2><p>这个我们实现不了因为拿不到证书。</p>
<p><img src="/.io//image-20250722110419480.png"></p>
<p>5.后端调用微信下单接口：</p>
<p><img src="/.io//image-20250722111258147.png"></p>
<p>9.用户确认支付，前端调用 <code>wx.requestPayment</code>，此时小程序界面就弹出支付界面。</p>
<p><img src="/.io//image-20250722111405786.png"></p>
<p>13.微信后台向后端发出回调接口，14.后端更新订单已完成状态。</p>
<p>接下来介绍cpolar：将本地服务映射到公网，使外部可以访问本地服务器。</p>
<p>常用于本地写了个微信&#x2F;支付宝支付接口，提供给第三方回调这种场景。</p>
<table>
<thead>
<tr>
<th>概念</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><strong>隧道（Tunnel）</strong></td>
<td>映射规则：本地端口 ➝ 公网地址</td>
</tr>
<tr>
<td><strong>公网地址</strong></td>
<td>系统自动生成的 <code>xxxxx.cpolar.cn</code> 地址</td>
</tr>
<tr>
<td><strong>临时&#x2F;固定地址</strong></td>
<td>免费版每天地址变化，专业版可自定义固定域名</td>
</tr>
<tr>
<td><strong>Web UI 控制台</strong></td>
<td>访问 <code>localhost:9200</code> 可查看隧道状态</td>
</tr>
</tbody></table>
<p>使用方法：下载安装，在官网找到隧道Authtoken复制，到安装目录打开cmd：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./cpolar.exe authtoken ********</span><br><span class="line">Authtoken saved to configuration file: C:\Users\30516/.cpolar/cpolar.yml</span><br></pre></td></tr></table></figure>

<p>接下来输入（8080取决于我们后端的端口号）：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./cpolar http <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<p>出现这样的界面：</p>
<p><img src="/.io//image-20250722132453237.png"></p>
<p>现在我们就可以通过上面的域名访问了，比如我们访问接口文档：<a target="_blank" rel="noopener" href="https://39dbf818.r16.cpolar.top/doc.html#/home">苍穹外卖项目接口文档</a>，是能够正常访问的</p>
<p>在配置微信支付的时候，回调的网址就可以以这个为前缀。</p>
<p>我们拿不到证书，直接改前端代码，按支付按钮直接跳转到支付成功界面即可。</p>
<h2 id="day10-1-订单定时处理-SpringTask"><a href="#day10-1-订单定时处理-SpringTask" class="headerlink" title="day10-1 订单定时处理 (SpringTask)"></a>day10-1 订单定时处理 (SpringTask)</h2><p><img src="/.io//image-20250722214125481.png"></p>
<p>CRON表达式手写较困难，一般采用AI生成。</p>
<p>接下来让我们进入定时处理的开发。</p>
<p>用户下单后会出现两种情况，用户下单后<strong>一直未支付</strong>，完成后管理端<strong>一直不点完成</strong>。前者我们可以每分钟检查一次，后者一天检查一次（凌晨检查）。</p>
<p>这里不需要接口设计，和前端无关。</p>
<p>注意要加@Component注解，代码实现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderTask</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderMapper orderMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 * * * * ?&quot;)</span> <span class="comment">// 每分钟触发一次</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processTimeoutOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">time</span> <span class="operator">=</span> LocalDateTime.now().plusMinutes(-<span class="number">15</span>);</span><br><span class="line">        List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrderTimeLT(Orders.PENDING_PAYMENT, time);</span><br><span class="line">        <span class="keyword">if</span> (ordersList != <span class="literal">null</span> &amp;&amp; !ordersList.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Orders order : ordersList) &#123;</span><br><span class="line">                order.setStatus(Orders.CANCELLED);</span><br><span class="line">                order.setCancelReason(<span class="string">&quot;订单超时未支付，已自动取消&quot;</span>);</span><br><span class="line">                order.setCancelTime(LocalDateTime.now());</span><br><span class="line">                orderMapper.update(order);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 1 * * ?&quot;)</span> <span class="comment">// 每天凌晨一点触发一次</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">processDeliveryOrder</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">LocalDateTime</span> <span class="variable">time</span> <span class="operator">=</span> LocalDateTime.now().plusMinutes(-<span class="number">60</span>);</span><br><span class="line">        List&lt;Orders&gt; ordersList = orderMapper.getByStatusAndOrderTimeLT(Orders.DELIVERY_IN_PROGRESS, time);</span><br><span class="line">        <span class="keyword">if</span> (ordersList != <span class="literal">null</span> &amp;&amp; !ordersList.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Orders order : ordersList) &#123;</span><br><span class="line">                order.setStatus(Orders.COMPLETED);</span><br><span class="line">                orderMapper.update(order);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="day10-7-来单提醒-客户催单-WebSocket"><a href="#day10-7-来单提醒-客户催单-WebSocket" class="headerlink" title="day10-7 来单提醒-客户催单 (WebSocket)"></a>day10-7 来单提醒-客户催单 (WebSocket)</h2><p>WebSocket是基于TCP的网络协议，实现浏览器和服务器的全双工通信：一次握手，持久连接，进行双向数据传输。适合实现聊天软件等。</p>
<p><img src="/.io//4681f3ab3bb89bd4f0bf773f3d8794f8.png"></p>
<p>使用websocket需要导入maven。</p>
<p>配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerEndpointExporter <span class="title function_">serverEndpointExporter</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServerEndpointExporter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单的示例websocket服务类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/ws/&#123;sid&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketServer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Session&gt; sessionMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpen</span><span class="params">(Session session, <span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        sessionMap.put(sid, session); <span class="comment">// 保存会话</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(String message, <span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        <span class="comment">// 处理客户端消息（当前仅日志记录）</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(<span class="meta">@PathParam(&quot;sid&quot;)</span> String sid)</span> &#123;</span><br><span class="line">        sessionMap.remove(sid); <span class="comment">// 移除会话</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendToAllClient</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="comment">// 遍历所有会话发送消息（全量广播）</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面我们正式开始开发来单提醒+客户催单代码：</p>
<p><img src="/.io//image-20250723142828787.png"></p>
<p>websocket服务类不变。</p>
<p>修改service：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">paySuccess</span><span class="params">(String outTradeNo)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据订单号查询订单</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getByNumber(outTradeNo);</span><br><span class="line">    <span class="comment">// 根据订单id更新订单的状态、支付方式、支付状态、结账时间</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">orders</span> <span class="operator">=</span> Orders.builder()</span><br><span class="line">        .id(ordersDB.getId())</span><br><span class="line">        .status(Orders.TO_BE_CONFIRMED)</span><br><span class="line">        .payStatus(Orders.PAID)</span><br><span class="line">        .checkoutTime(LocalDateTime.now())</span><br><span class="line">        .build();</span><br><span class="line">    orderMapper.update(orders);</span><br><span class="line">    Map map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;type&quot;</span>,<span class="number">1</span>);</span><br><span class="line">    map.put(<span class="string">&quot;orderId&quot;</span>,ordersDB.getId());</span><br><span class="line">    map.put(<span class="string">&quot;content&quot;</span>,<span class="string">&quot;订单号: &quot;</span>+outTradeNo);</span><br><span class="line">    String json=JSON.toJSONString(map);</span><br><span class="line">    websocketService.sendToAllClient(json);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面解决了来单提醒，下面开发客户催单。用户可以按一个按钮来进行催单，该按钮的api如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/reminder/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">reminder</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">    orderService.reminder(id);</span><br><span class="line">    <span class="keyword">return</span> Result.success();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>service中调用websocket，对后台管理客户端发出消息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reminder</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 根据id查询订单</span></span><br><span class="line">    <span class="type">Orders</span> <span class="variable">ordersDB</span> <span class="operator">=</span> orderMapper.getById(id);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 校验订单是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (ordersDB == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">OrderBusinessException</span>(MessageConstant.ORDER_STATUS_ERROR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Map map=<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    map.put(<span class="string">&quot;type&quot;</span>,<span class="number">2</span>);</span><br><span class="line">    map.put(<span class="string">&quot;orderId&quot;</span>,id);</span><br><span class="line">    map.put(<span class="string">&quot;content&quot;</span>,<span class="string">&quot;订单号: &quot;</span>+ordersDB.getNumber());</span><br><span class="line">    String json=JSON.toJSONString(map);</span><br><span class="line">    websocketService.sendToAllClient(json);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码实现完毕。</p>
<h2 id="day11-1-后台数据统计-Apache-ECharts"><a href="#day11-1-后台数据统计-Apache-ECharts" class="headerlink" title="day11-1 后台数据统计 (Apache ECharts)"></a>day11-1 后台数据统计 (Apache ECharts)</h2><p>Apache ECharts是前端技术，是一个由 Apache 软件基金会孵化和维护的 <strong>开源、纯 JavaScript 实现的可视化图表库</strong>，用于在网页中绘制丰富、交互性强的数据可视化图表。链接：<a target="_blank" rel="noopener" href="https://echarts.apache.org/handbook/zh/get-started/">快速上手 - 使用手册 - Apache ECharts</a></p>
<p>这块没啥新东西，纯无聊，只要大三数据库好好写这些sql都会写。</p>
<p>也就这个sql能讲讲：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;sumByMap&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Double&quot;</span>&gt;</span></span><br><span class="line">    select sum(amount) from orders</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;status != null&quot;</span>&gt;</span></span><br><span class="line">            and status = #&#123;status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;begin != null&quot;</span>&gt;</span></span><br><span class="line">            and order_time <span class="symbol">&amp;gt;</span>= #&#123;begin&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;end != null&quot;</span>&gt;</span></span><br><span class="line">            and order_time <span class="symbol">&amp;lt;</span>= #&#123;end&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里的符号是转义字符，是大于小于的意思。意思就是把这段时间内，status是status的营业额相加。</p>
<h2 id="day12-5-导出运营数据Excel报表-Apache-POI"><a href="#day12-5-导出运营数据Excel报表-Apache-POI" class="headerlink" title="day12-5 导出运营数据Excel报表 (Apache POI)"></a>day12-5 导出运营数据Excel报表 (Apache POI)</h2><p>POI可以让我们在java程序中对Office文件进行读写，一般都是操作excel文件。</p>
<p>我们一般不会从0开始构建一个excel，而是做一个模板放在template文件夹下，然后往这个模板里面填数字。</p>
<p>模板：</p>
<p><img src="/.io//image-20250723201545359.png"></p>
<p>控制器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/export&quot;)</span></span><br><span class="line"><span class="meta">@ApiOperation(&quot;导出运营数据报表&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">(HttpServletResponse response)</span>&#123;</span><br><span class="line">    reportService.exportBusinessData(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里参数要获取HttpServletResponse response，因为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">excel.write(out);</span><br></pre></td></tr></table></figure>

<p><code>response.getOutputStream()</code>：获取一个 <code>ServletOutputStream</code>，这是一个专门用于 HTTP 响应的输出流。</p>
<p><code>excel.write(out)</code>：将生成的 Excel 文件内容写入到输出流中，从而将文件发送给客户端。</p>
<p>service实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**导出近30天的运营数据报表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportBusinessData</span><span class="params">(HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">begin</span> <span class="operator">=</span> LocalDate.now().minusDays(<span class="number">30</span>);</span><br><span class="line">    <span class="type">LocalDate</span> <span class="variable">end</span> <span class="operator">=</span> LocalDate.now().minusDays(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//查询概览运营数据，提供给Excel模板文件</span></span><br><span class="line">    <span class="type">BusinessDataVO</span> <span class="variable">businessData</span> <span class="operator">=</span> workspaceService.getBusinessData(LocalDateTime.of(begin,LocalTime.MIN), LocalDateTime.of(end, LocalTime.MAX));</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader().getResourceAsStream(<span class="string">&quot;template/运营数据报表模板.xlsx&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//基于提供好的模板文件创建一个新的Excel表格对象</span></span><br><span class="line">        <span class="type">XSSFWorkbook</span> <span class="variable">excel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XSSFWorkbook</span>(inputStream);</span><br><span class="line">        <span class="comment">//获得Excel文件中的一个Sheet页</span></span><br><span class="line">        <span class="type">XSSFSheet</span> <span class="variable">sheet</span> <span class="operator">=</span> excel.getSheet(<span class="string">&quot;Sheet1&quot;</span>);</span><br><span class="line"></span><br><span class="line">        sheet.getRow(<span class="number">1</span>).getCell(<span class="number">1</span>).setCellValue(begin + <span class="string">&quot;至&quot;</span> + end);</span><br><span class="line">        <span class="comment">//获得第4行</span></span><br><span class="line">        <span class="type">XSSFRow</span> <span class="variable">row</span> <span class="operator">=</span> sheet.getRow(<span class="number">3</span>);</span><br><span class="line">        <span class="comment">//获取单元格</span></span><br><span class="line">        row.getCell(<span class="number">2</span>).setCellValue(businessData.getTurnover());</span><br><span class="line">        row.getCell(<span class="number">4</span>).setCellValue(businessData.getOrderCompletionRate());</span><br><span class="line">        row.getCell(<span class="number">6</span>).setCellValue(businessData.getNewUsers());</span><br><span class="line">        row = sheet.getRow(<span class="number">4</span>);</span><br><span class="line">        row.getCell(<span class="number">2</span>).setCellValue(businessData.getValidOrderCount());</span><br><span class="line">        row.getCell(<span class="number">4</span>).setCellValue(businessData.getUnitPrice());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span><br><span class="line">            <span class="type">LocalDate</span> <span class="variable">date</span> <span class="operator">=</span> begin.plusDays(i);</span><br><span class="line">            <span class="comment">//准备明细数据</span></span><br><span class="line">            businessData = workspaceService.getBusinessData(LocalDateTime.of(date,LocalTime.MIN), LocalDateTime.of(date, LocalTime.MAX));</span><br><span class="line">            row = sheet.getRow(<span class="number">7</span> + i);</span><br><span class="line">            row.getCell(<span class="number">1</span>).setCellValue(date.toString());</span><br><span class="line">            row.getCell(<span class="number">2</span>).setCellValue(businessData.getTurnover());</span><br><span class="line">            row.getCell(<span class="number">3</span>).setCellValue(businessData.getValidOrderCount());</span><br><span class="line">            row.getCell(<span class="number">4</span>).setCellValue(businessData.getOrderCompletionRate());</span><br><span class="line">            row.getCell(<span class="number">5</span>).setCellValue(businessData.getUnitPrice());</span><br><span class="line">            row.getCell(<span class="number">6</span>).setCellValue(businessData.getNewUsers());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//通过输出流将文件下载到客户端浏览器中</span></span><br><span class="line">        <span class="type">ServletOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> response.getOutputStream();</span><br><span class="line">        excel.write(out);</span><br><span class="line">        <span class="comment">//关闭资源</span></span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">        excel.close();</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>苍穹外卖结束。</p>
</div><div class="tags"><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/MyBatis/" rel="tag">MyBatis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Redis/" rel="tag">Redis</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/Spring-Boot/" rel="tag">Spring Boot</a></li></ul></div><div class="post-nav"><a class="next" href="../../01/Java-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/">Java-基础语法</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://trenchance2022.github.io"/></form></div><div class="widget"><div class="author-info"><a class="info-avatar" href="/about/" title="About"><img class="nofancybox" src="/img/trenchance.jpg"/></a><p>Give it your best shot.</p><a class="info-icon" href="https://github.com/trenchance2022" title="Github" target="_blank" style="margin-inline:5px"><img class="nofancybox" src="../../../../img/github.png" style="width: 20px; height: 20px; margin-inline:5px; vertical-align: middle;"/></a><a class="info-icon" href="https://b23.tv/CPgDyCs" title="Bilibili" target="_blank" style="margin-inline:5px"><img class="nofancybox" src="../../../../img/bilibili.png" style="width: 20px; height: 20px; margin-inline:5px; vertical-align: middle;"/></a><a class="info-icon" href="https://www.xiaohongshu.com/user/profile/62bece15000000001b027298" title="小红书" target="_blank" style="margin-inline:5px"><img class="nofancybox" src="../../../../img/xiaohongshu.png" style="width: 20px; height: 20px; margin-inline:5px; vertical-align: middle;"/></a><a class="info-icon" href="mailto:renzg2004@126.com" title="Email" target="_blank" style="margin-inline:5px"><img class="nofancybox" src="../../../../img/mail.png" style="width: 20px; height: 20px; margin-inline:5px; vertical-align: middle;"/></a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="../../../../tags/Java/" style="font-size: 15px;">Java</a> <a href="../../../../tags/SDN/" style="font-size: 15px;">SDN</a> <a href="../../../../tags/OpenFlow/" style="font-size: 15px;">OpenFlow</a> <a href="../../../../tags/%E7%8E%B0%E4%BB%A3%E4%BA%A4%E6%8D%A2%E5%8E%9F%E7%90%86/" style="font-size: 15px;">现代交换原理</a> <a href="../../../../tags/SIP/" style="font-size: 15px;">SIP</a> <a href="../../../../tags/Spring-Boot/" style="font-size: 15px;">Spring Boot</a> <a href="../../../../tags/vue/" style="font-size: 15px;">vue</a> <a href="../../../../tags/MyBatis/" style="font-size: 15px;">MyBatis</a> <a href="../../../../tags/html/" style="font-size: 15px;">html</a> <a href="../../../../tags/css/" style="font-size: 15px;">css</a> <a href="../../../../tags/javascript/" style="font-size: 15px;">javascript</a> <a href="../../../../tags/axios/" style="font-size: 15px;">axios</a> <a href="../../../../tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 15px;">操作系统</a> <a href="../../../../tags/Redis/" style="font-size: 15px;">Redis</a> <a href="../../../../tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84/" style="font-size: 15px;">计算机系统结构</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="">苍穹外卖笔记</a></li><li class="post-list-item"><a class="post-list-link" href="../../01/Java-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95/">Java-基础语法</a></li><li class="post-list-item"><a class="post-list-link" href="../../../06/21/SIP%E5%8D%8F%E8%AE%AE%E5%AE%9E%E9%AA%8C/">SIP协议实验</a></li><li class="post-list-item"><a class="post-list-link" href="../../../06/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%BB%93%E6%9E%84%E7%AC%94%E8%AE%B0/">计算机系统结构笔记</a></li><li class="post-list-item"><a class="post-list-link" href="../../../06/10/Spring-%E5%85%A8%E6%A0%88%E5%BC%80%E5%8F%91%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Spring-全栈开发学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="../../../05/17/SDN%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86%E4%B8%8EOpenFlow%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90/">SDN基本原理与OpenFlow协议分析</a></li><li class="post-list-item"><a class="post-list-link" href="../../../03/18/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E8%AF%BE%E7%A8%8B%E8%AE%BE%E8%AE%A1/">操作系统课程设计</a></li><li class="post-list-item"><a class="post-list-link" href="../../../03/01/%E5%89%8D%E7%AB%AF%E7%AC%94%E8%AE%B0/">前端笔记</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="https://github.com/trenchance2022" title="友链招募中" target="_blank">友链招募中</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2025 <a href="../../../../." rel="nofollow">Trenchance's Home.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="../../../../js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="../../../../js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="https://unpkg.com/@fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="../../../../js/copycode.js?v=1.0.0" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="../../../../css/copycode.css?v=1.0.0"><script type="text/javascript" src="../../../../js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="../../../../js/smartresize.js?v=1.0.0"></script></div></body></html>